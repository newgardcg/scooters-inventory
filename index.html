<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scooters Coffee - Inventory Manager Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .date-display {
            font-size: 16px;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .card.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .card .value {
            font-size: 28px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }

        button:hover {
            background: #5568d3;
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        button.danger {
            background: #dc3545;
        }

        button.danger:hover {
            background: #c82333;
        }

        button.success {
            background: #28a745;
        }

        button.success:hover {
            background: #218838;
        }

        button.large {
            padding: 20px 40px;
            font-size: 18px;
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            display: block;
        }

        .category-section {
            margin-bottom: 30px;
        }

        .category-header {
            background: #f8f9fa;
            padding: 12px 15px;
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #dee2e6;
            font-size: 14px;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        tr.low-stock {
            background: #fff3cd;
        }

        tr.low-stock td {
            color: #856404;
            font-weight: 600;
        }

        input[type="number"], input[type="text"], input[type="email"], textarea {
            width: 100%;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
        }

        input[type="number"]:focus, input[type="text"]:focus, input[type="email"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-ok {
            background: #d4edda;
            color: #155724;
        }

        .status-low {
            background: #fff3cd;
            color: #856404;
        }

        .status-critical {
            background: #f8d7da;
            color: #721c24;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .budget-gauge {
            max-width: 500px;
            margin: 30px auto;
            text-align: center;
        }

        .gauge-container {
            position: relative;
            width: 100%;
            height: 40px;
            background: #e9ecef;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
        }

        .gauge-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            border-radius: 20px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: bold;
        }

        .gauge-fill.over-budget {
            background: #dc3545;
        }

        .budget-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .budget-stat {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .budget-stat h4 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .budget-stat .number {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .count-wizard {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .count-item-card {
            background: #f8f9fa;
            padding: 40px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .count-item-card h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .count-item-card .category-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .count-input {
            font-size: 48px;
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border: 3px solid #667eea;
        }

        .progress-indicator {
            margin: 20px 0;
            color: #666;
            font-size: 14px;
        }

        .count-summary {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .count-summary h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .alert-box {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-weight: 600;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .sync-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        .sync-status.synced {
            background: #d4edda;
            color: #155724;
        }

        .sync-status.syncing {
            background: #fff3cd;
            color: #856404;
        }

        .sync-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px 4px;
            }

            .nav-tab {
                padding: 12px 15px;
                font-size: 13px;
            }

            .count-item-card h2 {
                font-size: 24px;
            }

            .count-input {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Scooters Coffee - Inventory Manager Pro</h1>
            <div class="date-display">
                Allen, Texas | <span id="currentDate"></span>
                <span id="syncStatus" class="sync-status" style="display: none;"></span>
            </div>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchView('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="switchView('dailyCount')">Daily Count</button>
            <button class="nav-tab" onclick="switchView('budget')">COGS Budget</button>
            <button class="nav-tab" onclick="switchView('orderSheet')">Order Sheet</button>
            <button class="nav-tab" onclick="switchView('settings')">Settings</button>
        </div>

        <div class="content">
            <!-- Dashboard View -->
            <div id="dashboard" class="view active">
                <div class="summary-cards">
                    <div class="card">
                        <h3>Total Inventory Value</h3>
                        <div class="value">$<span id="totalValue">0</span></div>
                    </div>
                    <div class="card warning">
                        <h3>Low Stock Items</h3>
                        <div class="value"><span id="lowStockCount">0</span></div>
                    </div>
                    <div class="card success">
                        <h3>Items Tracked</h3>
                        <div class="value"><span id="itemCount">0</span></div>
                    </div>
                    <div class="card" id="budgetCard">
                        <h3>Budget Status</h3>
                        <div class="value"><span id="budgetStatus">-</span></div>
                    </div>
                </div>

                <div id="budgetAlert"></div>
                <div id="autoEmailStatus"></div>

                <div class="controls">
                    <button onclick="switchView('dailyCount')">Start Daily Count</button>
                    <button class="secondary" onclick="openAddItemModal()">Add New Item</button>
                    <button class="secondary" onclick="switchView('orderSheet')">Generate Order Sheet</button>
                    <button class="secondary" onclick="exportToCSV()">Export to CSV</button>
                </div>

                <div id="inventoryContainer"></div>
            </div>

            <!-- Daily Count View -->
            <div id="dailyCount" class="view">
                <div class="count-wizard">
                    <h2>Daily Inventory Count</h2>
                    <p style="color: #666; margin: 10px 0 20px;">Count each item as you see it on the shelf. This should take less than 5 minutes.</p>

                    <div id="countContent"></div>
                </div>
            </div>

            <!-- Budget View -->
            <div id="budget" class="view">
                <h2 style="margin-bottom: 20px;">COGS Budget Tracker</h2>

                <div class="form-group" style="max-width: 500px; margin: 0 auto 30px;">
                    <label>Enter Your Weekly Gross Sales ($):</label>
                    <input type="number" id="weeklySales" step="0.01" placeholder="e.g., 15000" onchange="updateBudget()">
                </div>

                <div class="budget-gauge">
                    <h3>Inventory vs. Budget (32% Target)</h3>
                    <div class="gauge-container">
                        <div class="gauge-fill" id="gaugeFill" style="width: 0%">
                            <span id="gaugePercent">0%</span>
                        </div>
                    </div>
                    <div class="budget-info">
                        <div class="budget-stat">
                            <h4>Current Inventory Value</h4>
                            <div class="number">$<span id="budgetInventoryValue">0</span></div>
                        </div>
                        <div class="budget-stat">
                            <h4>32% Budget Target</h4>
                            <div class="number">$<span id="budgetTarget">0</span></div>
                        </div>
                    </div>
                    <div class="budget-info">
                        <div class="budget-stat">
                            <h4>Remaining Budget</h4>
                            <div class="number" style="color: #28a745;">$<span id="budgetRemaining">0</span></div>
                        </div>
                        <div class="budget-stat">
                            <h4>Budget Usage</h4>
                            <div class="number" id="budgetUsagePercent">0%</div>
                        </div>
                    </div>
                </div>

                <div id="budgetWarning"></div>

                <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px;">Understanding Your COGS Budget</h3>
                    <p style="margin-bottom: 10px;"><strong>Industry Standard:</strong> Coffee shops should aim for 28-32% COGS (Cost of Goods Sold).</p>
                    <p style="margin-bottom: 10px;"><strong>Your Target:</strong> 32% of gross sales should cover all inventory costs.</p>
                    <p style="margin-bottom: 10px;"><strong>Why This Matters:</strong> High COGS means less profit. Keeping inventory at 32% ensures healthy margins.</p>
                    <p><strong>Action Items:</strong> If you're over budget, review which items have the highest total value and look for waste, theft, or over-ordering.</p>
                </div>
            </div>

            <!-- Order Sheet View -->
            <div id="orderSheet" class="view">
                <h2 style="margin-bottom: 20px;">Weekly Order Sheet</h2>

                <div class="alert-box alert-success" style="margin-bottom: 20px;">
                    <strong>Friday Reminder:</strong> Generate your order sheet every Friday to order over the weekend!
                </div>

                <div class="controls">
                    <button onclick="generateOrderSheet()">üìã Generate Order Sheet</button>
                    <button class="success large" onclick="emailOrderSheet()" style="max-width: none; width: auto; display: inline-block; padding: 15px 30px;">
                        üìß Email Order Sheet (Opens Your Email App)
                    </button>
                    <button class="secondary" onclick="exportToCSV()">üíæ Export to CSV</button>
                </div>

                <div id="orderSheetContent"></div>
            </div>

            <!-- Settings View -->
            <div id="settings" class="view">
                <h2 style="margin-bottom: 20px;">Settings</h2>


                <h3 style="margin: 30px 0 15px 0;">Email Settings</h3>

                <div class="form-group">
                    <label>Store Email:</label>
                    <input type="email" id="storeEmail" placeholder="store@scooterscoffee.com">
                </div>

                <div class="form-group">
                    <label>Manager Emails (comma-separated):</label>
                    <textarea id="managerEmails" rows="3" placeholder="manager1@email.com, manager2@email.com"></textarea>
                </div>

                <h3 style="margin: 30px 0 15px 0;">üìß Email Method</h3>

                <div class="form-group">
                    <label>How do you want to send order sheets?</label>
                    <select id="emailMethod" style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 4px; font-size: 14px;" onchange="updateEmailMethod()">
                        <option value="simple">Simple - Opens my email app (Gmail/Outlook) with everything filled in</option>
                        <option value="advanced">Advanced - Fully automated via Cloudflare Workers (requires setup)</option>
                    </select>
                </div>

                <div id="simpleEmailInfo" class="alert-box alert-success" style="margin-top: 15px;">
                    <h4 style="margin: 0 0 10px 0;">‚úì Simple Email Method (Selected)</h4>
                    <p style="margin: 5px 0;">When you click "Email Order Sheet", your email app (Gmail/Outlook/Apple Mail) will open with:</p>
                    <ul style="margin: 10px 0 10px 20px;">
                        <li>‚úì Recipients already filled in</li>
                        <li>‚úì Subject line ready</li>
                        <li>‚úì Order sheet in the body</li>
                        <li>‚úì You just click "Send"</li>
                    </ul>
                    <p style="margin: 10px 0 0 0;"><strong>How to use:</strong> Every Friday, go to Order Sheet tab ‚Üí Click "Email Order Sheet" ‚Üí Click Send</p>
                </div>

                <div id="advancedEmailInfo" class="alert-box alert-info" style="margin-top: 15px; display: none;">
                    <h4 style="margin: 0 0 10px 0;">‚öôÔ∏è Advanced Method (Cloudflare Workers)</h4>
                    <p style="margin: 5px 0;">This requires technical setup but sends emails automatically every Friday at 7am without you doing anything.</p>
                    <p style="margin: 10px 0;"><strong>Setup time:</strong> 10-15 minutes (one-time)</p>
                    <p style="margin: 5px 0 0 0;"><a href="#" onclick="alert('Open QUICK-SETUP.txt on your Desktop for step-by-step instructions.'); return false;">View Setup Instructions</a></p>
                </div>

                <div id="advancedSettings" style="display: none;">
                    <h3 style="margin: 30px 0 15px 0;">Cloudflare Worker Settings</h3>

                    <div class="form-group">
                        <label>Cloudflare Worker URL:</label>
                        <input type="text" id="workerUrl" placeholder="https://your-worker.workers.dev">
                        <small style="color: #666; display: block; margin-top: 5px;">Get this after deploying your Cloudflare Worker</small>
                    </div>

                    <div class="form-group">
                        <label>API Key:</label>
                        <input type="text" id="apiKey" placeholder="scooters2106secret">
                        <small style="color: #666; display: block; margin-top: 5px;">Use: <code>scooters2106secret</code></small>
                    </div>
                </div>

                <h3 style="margin: 30px 0 15px 0;">Other Settings</h3>

                <div class="form-group">
                    <label>Order Lead Time (days):</label>
                    <input type="number" id="orderLeadTime" value="3" min="1">
                </div>

                <button onclick="saveSettings()">üíæ Save Settings</button>
                <button class="danger" style="margin-left: 10px;" onclick="resetAllData()">Reset All Data</button>

                <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px;">üí° How It Works</h3>

                    <div style="margin: 20px 0;">
                        <h4 style="margin: 0 0 10px 0;">üìß Simple Method (Selected)</h4>
                        <p style="margin: 0; line-height: 1.6;">
                            Every Friday, just click the "Email Order Sheet" button. Your email app (Gmail, Outlook, Apple Mail) will open with everything already filled in. You just click "Send". Takes 5 seconds!
                        </p>
                    </div>

                    <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 6px; border-left: 4px solid #667eea;">
                        <h4 style="margin: 0 0 10px 0;">‚öôÔ∏è Want Fully Automated Emails?</h4>
                        <p style="margin: 0 0 10px 0;">
                            Switch to "Advanced" method above. It requires a one-time 10-minute setup, but then emails send automatically every Friday at 7am without you doing anything.
                        </p>
                        <p style="margin: 0; font-size: 13px; color: #666;">
                            Instructions available in the <code>QUICK-SETUP.txt</code> file on your Desktop.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="modal">
        <div class="modal-content">
            <h2>Add New Inventory Item</h2>
            <div class="form-group">
                <label>Category:</label>
                <select id="newItemCategory" style="width: 100%; padding: 8px; border: 2px solid #dee2e6; border-radius: 4px;">
                    <option value="Dairy">Dairy</option>
                    <option value="Syrups & Flavorings">Syrups & Flavorings</option>
                    <option value="Coffee">Coffee</option>
                    <option value="Cups & Lids">Cups & Lids</option>
                    <option value="Supplies">Supplies</option>
                </select>
            </div>
            <div class="form-group">
                <label>Item Name:</label>
                <input type="text" id="newItemName" placeholder="e.g., Oat Milk">
            </div>
            <div class="form-group">
                <label>Unit:</label>
                <input type="text" id="newItemUnit" placeholder="e.g., gallons, bottles, boxes">
            </div>
            <div class="form-group">
                <label>Cost per Unit ($):</label>
                <input type="number" id="newItemCost" step="0.01" placeholder="0.00">
            </div>
            <div class="form-group">
                <label>Low Stock Alert Level:</label>
                <input type="number" id="newItemMinLevel" placeholder="e.g., 5">
            </div>
            <div class="form-group">
                <label>Current Quantity:</label>
                <input type="number" id="newItemQuantity" placeholder="0">
            </div>
            <div class="export-buttons">
                <button onclick="addNewItem()">Add Item</button>
                <button class="secondary" onclick="closeAddItemModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize inventory data structure
        let inventory = {
            "Dairy": [
                { name: "Whole Milk", unit: "gallons", cost: 4.50, minLevel: 8, quantity: 0 },
                { name: "2% Milk", unit: "gallons", cost: 4.50, minLevel: 8, quantity: 0 },
                { name: "Skim Milk", unit: "gallons", cost: 4.50, minLevel: 4, quantity: 0 },
                { name: "Half & Half", unit: "quarts", cost: 3.25, minLevel: 6, quantity: 0 },
                { name: "Heavy Cream", unit: "quarts", cost: 4.00, minLevel: 4, quantity: 0 },
                { name: "Almond Milk", unit: "cartons", cost: 5.50, minLevel: 3, quantity: 0 },
                { name: "Oat Milk", unit: "cartons", cost: 6.00, minLevel: 3, quantity: 0 }
            ],
            "Syrups & Flavorings": [
                { name: "Vanilla Syrup", unit: "bottles", cost: 8.50, minLevel: 2, quantity: 0 },
                { name: "Caramel Syrup", unit: "bottles", cost: 8.50, minLevel: 2, quantity: 0 },
                { name: "Hazelnut Syrup", unit: "bottles", cost: 8.50, minLevel: 1, quantity: 0 },
                { name: "Sugar-Free Vanilla", unit: "bottles", cost: 9.00, minLevel: 1, quantity: 0 },
                { name: "Mocha Powder", unit: "bags", cost: 12.00, minLevel: 2, quantity: 0 },
                { name: "White Chocolate Powder", unit: "bags", cost: 12.00, minLevel: 1, quantity: 0 },
                { name: "Caramel Sauce", unit: "bottles", cost: 7.50, minLevel: 2, quantity: 0 }
            ],
            "Coffee": [
                { name: "Espresso Beans", unit: "lbs", cost: 8.00, minLevel: 10, quantity: 0 },
                { name: "Drip Coffee Beans", unit: "lbs", cost: 6.50, minLevel: 10, quantity: 0 },
                { name: "Decaf Beans", unit: "lbs", cost: 7.00, minLevel: 5, quantity: 0 },
                { name: "Cold Brew Concentrate", unit: "gallons", cost: 15.00, minLevel: 3, quantity: 0 }
            ],
            "Cups & Lids": [
                { name: "12oz Cups", unit: "sleeves", cost: 12.00, minLevel: 5, quantity: 0 },
                { name: "16oz Cups", unit: "sleeves", cost: 14.00, minLevel: 8, quantity: 0 },
                { name: "20oz Cups", unit: "sleeves", cost: 16.00, minLevel: 5, quantity: 0 },
                { name: "24oz Cups", unit: "sleeves", cost: 18.00, minLevel: 3, quantity: 0 },
                { name: "Small Lids", unit: "sleeves", cost: 8.00, minLevel: 5, quantity: 0 },
                { name: "Large Lids", unit: "sleeves", cost: 9.00, minLevel: 8, quantity: 0 },
                { name: "Cup Sleeves", unit: "boxes", cost: 15.00, minLevel: 3, quantity: 0 },
                { name: "Straws", unit: "boxes", cost: 8.00, minLevel: 2, quantity: 0 }
            ],
            "Supplies": [
                { name: "Napkins", unit: "cases", cost: 20.00, minLevel: 2, quantity: 0 },
                { name: "Stirrers", unit: "boxes", cost: 6.00, minLevel: 2, quantity: 0 },
                { name: "Sugar Packets", unit: "boxes", cost: 12.00, minLevel: 2, quantity: 0 },
                { name: "Sweetener Packets", unit: "boxes", cost: 14.00, minLevel: 2, quantity: 0 },
                { name: "Cleaning Supplies", unit: "kit", cost: 25.00, minLevel: 1, quantity: 0 },
                { name: "Paper Towels", unit: "cases", cost: 18.00, minLevel: 2, quantity: 0 }
            ]
        };

        let settings = {
            storeEmail: 'store2106@gmail.com',
            managerEmails: 'newgardcg@gmail.com',
            orderLeadTime: 3,
            weeklySales: 0,
            workerUrl: '',
            apiKey: 'scooters2106secret',
            autoEmailEnabled: 'no',
            emailMethod: 'simple'
        };

        let previousInventory = null;
        let countIndex = 0;
        let countItems = [];

        // Load saved data from localStorage
        function loadData() {
            const saved = localStorage.getItem('scootersInventory');
            if (saved) {
                inventory = JSON.parse(saved);
            }

            const savedSettings = localStorage.getItem('scootersSettings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                document.getElementById('storeEmail').value = settings.storeEmail || '';
                document.getElementById('managerEmails').value = settings.managerEmails || '';
                document.getElementById('orderLeadTime').value = settings.orderLeadTime || 3;
                document.getElementById('weeklySales').value = settings.weeklySales || 0;
                document.getElementById('emailMethod').value = settings.emailMethod || 'simple';
                document.getElementById('workerUrl').value = settings.workerUrl || '';
                document.getElementById('apiKey').value = settings.apiKey || '';
            }

            const savedPrevious = localStorage.getItem('scootersPreviousInventory');
            if (savedPrevious) {
                previousInventory = JSON.parse(savedPrevious);
            }

            updateDisplay();
            updateBudget();
            updateEmailMethod();
            checkFridayAndShowReminder();
        }

        // Save data to localStorage
        function saveInventory() {
            localStorage.setItem('scootersInventory', JSON.stringify(inventory));
            updateDisplay();
            updateBudget();

            // Auto-sync to cloud if enabled
            if (settings.autoEmailEnabled === 'yes' && settings.workerUrl) {
                syncToCloud();
            }
        }

        function saveSettings() {
            settings.storeEmail = document.getElementById('storeEmail').value;
            settings.managerEmails = document.getElementById('managerEmails').value;
            settings.orderLeadTime = document.getElementById('orderLeadTime').value;
            settings.weeklySales = parseFloat(document.getElementById('weeklySales').value) || 0;
            settings.emailMethod = document.getElementById('emailMethod').value;

            // Only save these if advanced method is selected
            if (settings.emailMethod === 'advanced') {
                settings.workerUrl = document.getElementById('workerUrl').value.trim();
                settings.apiKey = document.getElementById('apiKey').value.trim();
            }

            localStorage.setItem('scootersSettings', JSON.stringify(settings));
            alert('Settings saved successfully!');

            // Sync data after saving settings (only if advanced mode)
            if (settings.emailMethod === 'advanced' && settings.workerUrl && settings.apiKey) {
                syncToCloud();
            }
        }

        function updateEmailMethod() {
            const method = document.getElementById('emailMethod').value;
            settings.emailMethod = method;

            const simpleInfo = document.getElementById('simpleEmailInfo');
            const advancedInfo = document.getElementById('advancedEmailInfo');
            const advancedSettings = document.getElementById('advancedSettings');

            if (method === 'simple') {
                simpleInfo.style.display = 'block';
                advancedInfo.style.display = 'none';
                advancedSettings.style.display = 'none';
            } else {
                simpleInfo.style.display = 'none';
                advancedInfo.style.display = 'block';
                advancedSettings.style.display = 'block';
            }
        }

        function checkFridayAndShowReminder() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 5 = Friday

            if (dayOfWeek === 5) { // Friday
                const alertDiv = document.getElementById('budgetAlert');
                if (alertDiv) {
                    alertDiv.innerHTML = `
                        <div class="alert-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                            <h3 style="margin: 0 0 10px 0; color: white;">üéØ It's Friday! Time to Order</h3>
                            <p style="margin: 5px 0;">Generate your weekly order sheet and send it to your suppliers.</p>
                            <button onclick="switchView('orderSheet')" style="margin-top: 10px; background: white; color: #667eea;">
                                Go to Order Sheet ‚Üí
                            </button>
                        </div>
                    `;
                }

                // Show browser notification if allowed
                if (Notification.permission === 'granted') {
                    new Notification('Scooters Coffee - Weekly Order', {
                        body: 'It\'s Friday! Time to generate and send your weekly order sheet.',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="80" font-size="80">‚òï</text></svg>'
                    });
                }
            }
        }

        // Sync data to cloud
        async function syncToCloud() {
            if (!settings.workerUrl || !settings.apiKey) {
                alert('Please configure Worker URL and API Key in Settings first.');
                return;
            }

            const syncStatus = document.getElementById('syncStatus');
            syncStatus.textContent = '‚è≥ Syncing...';
            syncStatus.className = 'sync-status syncing';
            syncStatus.style.display = 'inline-block';

            try {
                const response = await fetch(settings.workerUrl + '/sync', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': settings.apiKey
                    },
                    body: JSON.stringify({
                        inventory: inventory,
                        settings: {
                            storeEmail: settings.storeEmail,
                            managerEmails: settings.managerEmails,
                            weeklySales: settings.weeklySales
                        }
                    })
                });

                if (response.ok) {
                    syncStatus.textContent = '‚úì Synced';
                    syncStatus.className = 'sync-status synced';
                    setTimeout(() => {
                        syncStatus.style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error('Sync failed');
                }
            } catch (error) {
                syncStatus.textContent = '‚úó Sync Failed';
                syncStatus.className = 'sync-status error';
                console.error('Sync error:', error);
            }
        }

        // Test automated email
        async function testAutoEmail() {
            if (!settings.workerUrl || !settings.apiKey) {
                alert('Please configure Worker URL and API Key in Settings first.');
                return;
            }

            if (confirm('This will send a test order sheet email now. Continue?')) {
                try {
                    const response = await fetch(settings.workerUrl + '/test-email', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-API-Key': settings.apiKey
                        }
                    });

                    if (response.ok) {
                        alert('Test email sent! Check your inbox.');
                    } else {
                        const data = await response.json();
                        alert('Error sending test email: ' + (data.error || 'Unknown error'));
                    }
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }

        // Update setup status
        function updateSetupStatus() {
            const statusDiv = document.getElementById('setupStatus');
            const autoEmailDiv = document.getElementById('autoEmailStatus');

            const hasEmails = settings.storeEmail || settings.managerEmails;
            const hasWorker = settings.workerUrl && settings.apiKey;
            const isEnabled = settings.autoEmailEnabled === 'yes';

            if (hasEmails && hasWorker && isEnabled) {
                statusDiv.className = 'alert-box alert-success';
                statusDiv.innerHTML = '<strong>‚úì Automated emails enabled!</strong> Order sheets will be sent every Friday at 7am Central Time.';

                autoEmailDiv.innerHTML = '<div class="alert-box alert-success">‚úì Automated Friday emails are active</div>';
            } else if (!hasEmails) {
                statusDiv.className = 'alert-box alert-warning';
                statusDiv.innerHTML = '<strong>‚ö† Step 1:</strong> Add your email addresses above';
                autoEmailDiv.innerHTML = '';
            } else if (!hasWorker) {
                statusDiv.className = 'alert-box alert-warning';
                statusDiv.innerHTML = '<strong>‚ö† Step 2:</strong> Set up Cloudflare Worker (see instructions below)';
                autoEmailDiv.innerHTML = '';
            } else if (!isEnabled) {
                statusDiv.className = 'alert-box alert-info';
                statusDiv.innerHTML = '<strong>‚Ñπ Ready:</strong> Enable "Automated Friday Emails" above to activate';
                autoEmailDiv.innerHTML = '';
            }
        }

        // Switch between views
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

            document.getElementById(viewName).classList.add('active');
            event.target.classList.add('active');

            if (viewName === 'orderSheet') {
                generateOrderSheet();
            }
        }

        // Update the display
        function updateDisplay() {
            const container = document.getElementById('inventoryContainer');
            container.innerHTML = '';

            let totalValue = 0;
            let lowStockCount = 0;
            let itemCount = 0;

            for (const [category, items] of Object.entries(inventory)) {
                itemCount += items.length;

                const section = document.createElement('div');
                section.className = 'category-section';

                const header = document.createElement('div');
                header.className = 'category-header';
                header.textContent = category;
                section.appendChild(header);

                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Current Count</th>
                            <th>Unit</th>
                            <th>Cost/Unit</th>
                            <th>Total Value</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="${category}-tbody"></tbody>
                `;

                const tbody = table.querySelector('tbody');

                items.forEach((item, index) => {
                    const itemValue = item.quantity * item.cost;
                    totalValue += itemValue;

                    let status = 'OK';
                    let statusClass = 'status-ok';
                    let rowClass = '';

                    if (item.quantity <= item.minLevel / 2) {
                        status = 'CRITICAL';
                        statusClass = 'status-critical';
                        rowClass = 'low-stock';
                        lowStockCount++;
                    } else if (item.quantity <= item.minLevel) {
                        status = 'LOW';
                        statusClass = 'status-low';
                        rowClass = 'low-stock';
                        lowStockCount++;
                    }

                    const row = document.createElement('tr');
                    row.className = rowClass;
                    row.innerHTML = `
                        <td><strong>${item.name}</strong></td>
                        <td><input type="number" value="${item.quantity}" onchange="updateQuantity('${category}', ${index}, this.value)" style="width: 80px;"></td>
                        <td>${item.unit}</td>
                        <td>$${item.cost.toFixed(2)}</td>
                        <td><strong>$${itemValue.toFixed(2)}</strong></td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td><button class="danger" style="padding: 6px 12px; font-size: 12px;" onclick="deleteItem('${category}', ${index})">Delete</button></td>
                    `;
                    tbody.appendChild(row);
                });

                section.appendChild(table);
                container.appendChild(section);
            }

            document.getElementById('totalValue').textContent = totalValue.toFixed(2);
            document.getElementById('lowStockCount').textContent = lowStockCount;
            document.getElementById('itemCount').textContent = itemCount;
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Update quantity for an item
        function updateQuantity(category, index, value) {
            inventory[category][index].quantity = parseFloat(value) || 0;
            updateDisplay();
        }

        // Delete an item
        function deleteItem(category, index) {
            if (confirm('Are you sure you want to delete this item?')) {
                inventory[category].splice(index, 1);
                updateDisplay();
                saveInventory();
            }
        }

        // Modal functions
        function openAddItemModal() {
            document.getElementById('addItemModal').style.display = 'block';
        }

        function closeAddItemModal() {
            document.getElementById('addItemModal').style.display = 'none';
            document.getElementById('newItemName').value = '';
            document.getElementById('newItemUnit').value = '';
            document.getElementById('newItemCost').value = '';
            document.getElementById('newItemMinLevel').value = '';
            document.getElementById('newItemQuantity').value = '';
        }

        function addNewItem() {
            const category = document.getElementById('newItemCategory').value;
            const name = document.getElementById('newItemName').value.trim();
            const unit = document.getElementById('newItemUnit').value.trim();
            const cost = parseFloat(document.getElementById('newItemCost').value) || 0;
            const minLevel = parseInt(document.getElementById('newItemMinLevel').value) || 0;
            const quantity = parseInt(document.getElementById('newItemQuantity').value) || 0;

            if (!name || !unit) {
                alert('Please enter item name and unit.');
                return;
            }

            const newItem = { name, unit, cost, minLevel, quantity };
            inventory[category].push(newItem);

            updateDisplay();
            closeAddItemModal();
            saveInventory();
        }

        // Daily Count Mode
        function startDailyCount() {
            previousInventory = JSON.parse(JSON.stringify(inventory));
            localStorage.setItem('scootersPreviousInventory', JSON.stringify(previousInventory));

            countItems = [];
            for (const [category, items] of Object.entries(inventory)) {
                items.forEach((item, index) => {
                    countItems.push({ category, index, ...item });
                });
            }

            countIndex = 0;
            showCountItem();
        }

        function showCountItem() {
            const content = document.getElementById('countContent');

            if (countIndex >= countItems.length) {
                finishDailyCount();
                return;
            }

            const item = countItems[countIndex];
            const progress = `${countIndex + 1} of ${countItems.length}`;

            content.innerHTML = `
                <div class="progress-indicator">Item ${progress}</div>
                <div class="count-item-card">
                    <span class="category-tag">${item.category}</span>
                    <h2>${item.name}</h2>
                    <p style="color: #666; margin: 10px 0;">Unit: ${item.unit}</p>
                    <input type="number" id="countInput" class="count-input" placeholder="0" autofocus>
                    <p style="color: #999; font-size: 14px;">Current: ${item.quantity} ${item.unit}</p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="large" onclick="saveCountAndNext()">Next</button>
                    ${countIndex > 0 ? '<button class="secondary" onclick="previousCountItem()">Back</button>' : ''}
                    <button class="danger" onclick="cancelCount()">Cancel</button>
                </div>
            `;

            document.getElementById('countInput').focus();
            document.getElementById('countInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveCountAndNext();
                }
            });
        }

        function saveCountAndNext() {
            const input = document.getElementById('countInput');
            const value = parseFloat(input.value) || 0;

            const item = countItems[countIndex];
            inventory[item.category][item.index].quantity = value;

            countIndex++;
            showCountItem();
        }

        function previousCountItem() {
            if (countIndex > 0) {
                countIndex--;
                showCountItem();
            }
        }

        function cancelCount() {
            if (confirm('Cancel inventory count? Changes will not be saved.')) {
                switchView('dashboard');
            }
        }

        function finishDailyCount() {
            saveInventory();

            let changesHtml = '<div class="count-summary"><h3>Count Complete!</h3>';
            let criticalItems = [];

            if (previousInventory) {
                changesHtml += '<h4 style="margin-top: 20px;">Changes Since Last Count:</h4>';
                for (const [category, items] of Object.entries(inventory)) {
                    items.forEach((item, index) => {
                        const prevItem = previousInventory[category][index];
                        if (prevItem && prevItem.quantity !== item.quantity) {
                            const diff = item.quantity - prevItem.quantity;
                            const diffText = diff > 0 ? `+${diff}` : diff;
                            changesHtml += `<div class="summary-item"><span>${item.name}</span><span>${diffText} ${item.unit}</span></div>`;
                        }

                        if (item.quantity <= item.minLevel / 2) {
                            criticalItems.push(item.name);
                        }
                    });
                }
            }

            changesHtml += '</div>';

            if (criticalItems.length > 0) {
                changesHtml += `<div class="alert-box alert-danger">
                    <strong>CRITICAL:</strong> ${criticalItems.length} item(s) need immediate ordering: ${criticalItems.join(', ')}
                </div>`;
            }

            changesHtml += '<button class="large" onclick="switchView(\'dashboard\')">Back to Dashboard</button>';

            document.getElementById('countContent').innerHTML = changesHtml;
        }

        // Budget Tracker
        function updateBudget() {
            const weeklySales = parseFloat(document.getElementById('weeklySales').value) || 0;
            settings.weeklySales = weeklySales;

            let totalValue = 0;
            for (const [category, items] of Object.entries(inventory)) {
                items.forEach(item => {
                    totalValue += item.quantity * item.cost;
                });
            }

            const budgetTarget = weeklySales * 0.32;
            const remaining = budgetTarget - totalValue;
            const usagePercent = budgetTarget > 0 ? (totalValue / budgetTarget * 100) : 0;

            document.getElementById('budgetInventoryValue').textContent = totalValue.toFixed(2);
            document.getElementById('budgetTarget').textContent = budgetTarget.toFixed(2);
            document.getElementById('budgetRemaining').textContent = remaining.toFixed(2);
            document.getElementById('budgetUsagePercent').textContent = usagePercent.toFixed(1) + '%';

            const gaugeFill = document.getElementById('gaugeFill');
            const gaugePercent = document.getElementById('gaugePercent');
            const width = Math.min(usagePercent, 100);
            gaugeFill.style.width = width + '%';
            gaugePercent.textContent = usagePercent.toFixed(1) + '%';

            if (usagePercent > 100) {
                gaugeFill.classList.add('over-budget');
            } else {
                gaugeFill.classList.remove('over-budget');
            }

            const budgetCard = document.getElementById('budgetCard');
            const budgetStatus = document.getElementById('budgetStatus');

            if (usagePercent > 100) {
                budgetStatus.textContent = 'OVER';
                budgetCard.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
            } else if (usagePercent > 90) {
                budgetStatus.textContent = 'WARNING';
                budgetCard.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
            } else {
                budgetStatus.textContent = 'GOOD';
                budgetCard.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }

            const budgetWarning = document.getElementById('budgetWarning');
            const budgetAlert = document.getElementById('budgetAlert');

            if (usagePercent > 100) {
                const overAmount = totalValue - budgetTarget;
                budgetWarning.innerHTML = `<div class="alert-box alert-danger">
                    <strong>OVER BUDGET!</strong> You are $${overAmount.toFixed(2)} over your 32% COGS target.
                    Review high-value items and reduce ordering.
                </div>`;
                budgetAlert.innerHTML = budgetWarning.innerHTML;
            } else if (usagePercent > 90) {
                budgetWarning.innerHTML = `<div class="alert-box alert-warning">
                    <strong>APPROACHING BUDGET LIMIT</strong> You are at ${usagePercent.toFixed(1)}% of your 32% COGS target.
                    Be careful with new orders.
                </div>`;
                budgetAlert.innerHTML = budgetWarning.innerHTML;
            } else if (weeklySales > 0) {
                budgetWarning.innerHTML = `<div class="alert-box alert-success">
                    <strong>BUDGET HEALTHY!</strong> You are at ${usagePercent.toFixed(1)}% of your 32% COGS target.
                    You have $${remaining.toFixed(2)} remaining.
                </div>`;
                budgetAlert.innerHTML = '';
            } else {
                budgetWarning.innerHTML = '';
                budgetAlert.innerHTML = '';
            }
        }

        // Order Sheet Functions
        function generateOrderSheet() {
            const content = document.getElementById('orderSheetContent');
            let orderItems = [];

            for (const [category, items] of Object.entries(inventory)) {
                items.forEach(item => {
                    if (item.quantity <= item.minLevel) {
                        const reorderQty = Math.ceil((item.minLevel * 2) - item.quantity);
                        const status = item.quantity <= item.minLevel / 2 ? 'CRITICAL' : 'LOW';
                        orderItems.push({
                            category,
                            name: item.name,
                            unit: item.unit,
                            current: item.quantity,
                            minLevel: item.minLevel,
                            reorderQty: reorderQty,
                            cost: item.cost,
                            total: reorderQty * item.cost,
                            status
                        });
                    }
                });
            }

            if (orderItems.length === 0) {
                content.innerHTML = '<div class="alert-box alert-success">All items are fully stocked! No orders needed this week.</div>';
                return;
            }

            let totalCost = orderItems.reduce((sum, item) => sum + item.total, 0);

            let html = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>Order Summary - ${new Date().toLocaleDateString()}</h3>
                    <p><strong>Total Items to Order:</strong> ${orderItems.length}</p>
                    <p><strong>Estimated Order Cost:</strong> $${totalCost.toFixed(2)}</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Category</th>
                            <th>Item</th>
                            <th>Current</th>
                            <th>Min Level</th>
                            <th>Order Qty</th>
                            <th>Unit Cost</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            orderItems.forEach(item => {
                const statusClass = item.status === 'CRITICAL' ? 'status-critical' : 'status-low';
                const rowClass = item.status === 'CRITICAL' ? 'low-stock' : '';
                html += `
                    <tr class="${rowClass}">
                        <td><span class="status-badge ${statusClass}">${item.status}</span></td>
                        <td>${item.category}</td>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.current} ${item.unit}</td>
                        <td>${item.minLevel}</td>
                        <td><strong>${item.reorderQty} ${item.unit}</strong></td>
                        <td>$${item.cost.toFixed(2)}</td>
                        <td><strong>$${item.total.toFixed(2)}</strong></td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            content.innerHTML = html;
        }

        function emailOrderSheet() {
            let orderItems = [];

            for (const [category, items] of Object.entries(inventory)) {
                items.forEach(item => {
                    if (item.quantity <= item.minLevel) {
                        const reorderQty = Math.ceil((item.minLevel * 2) - item.quantity);
                        const status = item.quantity <= item.minLevel / 2 ? 'CRITICAL' : 'LOW';
                        orderItems.push({
                            category,
                            name: item.name,
                            unit: item.unit,
                            current: item.quantity,
                            reorderQty: reorderQty,
                            cost: item.cost,
                            total: reorderQty * item.cost,
                            status
                        });
                    }
                });
            }

            if (orderItems.length === 0) {
                alert('No items need ordering!');
                return;
            }

            let totalCost = orderItems.reduce((sum, item) => sum + item.total, 0);

            let emailBody = `SCOOTERS COFFEE - WEEKLY ORDER SHEET\n`;
            emailBody += `Date: ${new Date().toLocaleDateString()}\n`;
            emailBody += `Allen, Texas Location\n\n`;
            emailBody += `SUMMARY:\n`;
            emailBody += `Total Items: ${orderItems.length}\n`;
            emailBody += `Estimated Cost: $${totalCost.toFixed(2)}\n\n`;
            emailBody += `ORDER LIST:\n`;
            emailBody += `${'='.repeat(60)}\n\n`;

            let currentCategory = '';
            orderItems.forEach(item => {
                if (item.category !== currentCategory) {
                    currentCategory = item.category;
                    emailBody += `\n${currentCategory.toUpperCase()}\n${'-'.repeat(40)}\n`;
                }
                emailBody += `${item.status === 'CRITICAL' ? '‚ö†Ô∏è ' : ''}${item.name}\n`;
                emailBody += `  Current: ${item.current} ${item.unit} | Order: ${item.reorderQty} ${item.unit}\n`;
                emailBody += `  Cost: $${item.cost.toFixed(2)} each = $${item.total.toFixed(2)} total\n\n`;
            });

            emailBody += `\n${'='.repeat(60)}\n`;
            emailBody += `TOTAL ORDER COST: $${totalCost.toFixed(2)}\n\n`;
            emailBody += `Generated by Scooters Inventory Manager`;

            const recipients = [settings.storeEmail, settings.managerEmails].filter(e => e).join(',');
            const subject = `Weekly Order Sheet - ${new Date().toLocaleDateString()}`;
            const mailtoLink = `mailto:${recipients}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;

            window.location.href = mailtoLink;
        }

        // Export to CSV
        function exportToCSV() {
            let csv = 'Category,Item,Quantity,Unit,Cost per Unit,Total Value,Min Level,Status\n';

            for (const [category, items] of Object.entries(inventory)) {
                items.forEach(item => {
                    const itemValue = item.quantity * item.cost;
                    let status = 'OK';
                    if (item.quantity <= item.minLevel / 2) {
                        status = 'CRITICAL';
                    } else if (item.quantity <= item.minLevel) {
                        status = 'LOW';
                    }
                    csv += `${category},"${item.name}",${item.quantity},${item.unit},${item.cost.toFixed(2)},${itemValue.toFixed(2)},${item.minLevel},${status}\n`;
                });
            }

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Scooters-Inventory-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Reset all data
        function resetAllData() {
            if (confirm('Are you sure you want to reset ALL data? This will clear all quantities and cannot be undone.')) {
                if (confirm('Really? This will delete everything!')) {
                    localStorage.removeItem('scootersInventory');
                    localStorage.removeItem('scootersPreviousInventory');
                    location.reload();
                }
            }
        }

        // Initialize on page load
        window.onload = function() {
            loadData();
        };

        // Add click handler to start daily count from dashboard
        document.addEventListener('DOMContentLoaded', function() {
            const dailyCountButton = document.querySelector('button[onclick="switchView(\'dailyCount\')"]');
            if (dailyCountButton) {
                dailyCountButton.onclick = function() {
                    switchView('dailyCount');
                    startDailyCount();
                };
            }
        });
    </script>
</body>
</html>