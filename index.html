<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scooters Coffee - Inventory Manager</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
        }

        h1 { font-size: 28px; margin-bottom: 10px; }
        h2 { margin-bottom: 20px; color: #333; }
        h3 { font-size: 18px; margin-bottom: 10px; }

        .nav-tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #dee2e6; overflow-x: auto; }
        .nav-tab { padding: 15px 18px; cursor: pointer; border: none; background: transparent; font-weight: 600; color: #666; transition: all 0.3s; white-space: nowrap; font-size: 12px; }
        .nav-tab:hover { background: #e9ecef; }
        .nav-tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .content { padding: 30px; }
        .view { display: none; }
        .view.active { display: block; }

        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card h3 { font-size: 14px; margin-bottom: 10px; opacity: 0.9; }
        .card .value { font-size: 28px; font-weight: bold; }

        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        button { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: background 0.3s; }
        button:hover { background: #5568d3; }
        button.secondary { background: #6c757d; }
        button.secondary:hover { background: #5a6268; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        button.large { padding: 15px 30px; font-size: 16px; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 13px; }
        th { background: #f8f9fa; padding: 10px 8px; text-align: left; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6; font-size: 12px; }
        td { padding: 10px 8px; border-bottom: 1px solid #dee2e6; }
        tr.low-stock { background: #fff3cd; }
        tr.low-stock td { color: #856404; font-weight: 600; }
        tr.green { background: #d4edda; }
        tr.yellow { background: #fff3cd; }
        tr.red { background: #f8d7da; }
        tr.over-order { background: #f8d7da; }

        input[type="number"], input[type="text"], input[type="email"], input[type="date"], textarea, select {
            width: 100%; padding: 8px; border: 2px solid #dee2e6; border-radius: 4px; font-size: 14px;
        }

        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .status-ok { background: #d4edda; color: #155724; }
        .status-low { background: #fff3cd; color: #856404; }
        .status-critical { background: #f8d7da; color: #721c24; }

        .alert-box { padding: 15px; border-radius: 6px; margin: 20px 0; font-weight: 600; }
        .alert-success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .alert-warning { background: #fff3cd; color: #856404; border-left: 4px solid #ffc107; }
        .alert-danger { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        .item-code { color: #667eea; font-family: monospace; font-size: 11px; }

        .gap-display { font-size: 48px; color: #dc3545; font-weight: bold; text-align: center; padding: 30px; background: #f8d7da; border-radius: 8px; margin: 20px 0; }
        .budget-display { font-size: 48px; font-weight: bold; text-align: center; padding: 30px; border-radius: 8px; margin: 20px 0; }
        .budget-ok { background: #d4edda; color: #155724; }
        .budget-warning { background: #fff3cd; color: #856404; }
        .budget-danger { background: #f8d7da; color: #721c24; }

        .checklist { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .checklist-item { padding: 10px; margin: 5px 0; background: white; border-radius: 4px; display: flex; align-items: center; }
        .checklist-item input[type="checkbox"] { margin-right: 10px; width: 20px; height: 20px; }

        .recommendation-box { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 25px; border-radius: 8px; margin: 20px 0; }
        .recommendation-box h3 { color: white; margin-bottom: 15px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }

        .profit-item { padding: 15px; border-radius: 8px; margin: 10px 0; }
        .profit-green { background: #d4edda; border-left: 4px solid #28a745; }
        .profit-yellow { background: #fff3cd; border-left: 4px solid #ffc107; }
        .profit-red { background: #f8d7da; border-left: 4px solid #dc3545; }

        .savings-box { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 25px; border-radius: 8px; margin: 20px 0; text-align: center; }
        .savings-amount { font-size: 42px; font-weight: bold; margin: 15px 0; }

        .milk-box { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; padding: 25px; border-radius: 8px; margin: 20px 0; }
        .milk-input { width: 100px; padding: 6px; margin: 5px; }
        .order-input { width: 80px; padding: 6px; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @media (max-width: 768px) {
            .content { padding: 15px; }
            table { font-size: 11px; }
            th, td { padding: 6px 4px; }
            .nav-tab { padding: 12px 10px; font-size: 11px; }
            .gap-display, .budget-display { font-size: 32px; padding: 20px; }
            .order-input, .milk-input { width: 60px; }
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDl63k-rzjAE7rRFFGyu2PuBGCqPfFlDOA",
            authDomain: "scooters-inventory.firebaseapp.com",
            databaseURL: "https://scooters-inventory-default-rtdb.firebaseio.com",
            projectId: "scooters-inventory",
            storageBucket: "scooters-inventory.firebasestorage.app",
            messagingSenderId: "863956546619",
            appId: "1:863956546619:web:c4b8cd532c33f6d722d81e",
            measurementId: "G-P3ZTZ8ZY19"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚òï Scooters Coffee #2106 - Inventory</h1>
            <div style="opacity: 0.9; margin-top: 5px;">Allen, Texas | Harvest Roasting Prices | <span id="currentDate"></span></div>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchView('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="switchView('dailyCount')">Daily Count</button>
            <button class="nav-tab" onclick="switchView('orderSheet')">Order Sheet</button>
            <button class="nav-tab" onclick="switchView('smartOrder')">Smart Order</button>
            <button class="nav-tab" onclick="switchView('cogsGap')">COGS Gap</button>
            <button class="nav-tab" onclick="switchView('menuProfit')">Menu Profit</button>
            <button class="nav-tab" onclick="switchView('settings')">Settings</button>
        </div>

        <div class="content">
            <!-- Last Updated Banner -->
            <div id="lastUpdatedBanner" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 12px 20px; border-radius: 6px; margin-bottom: 20px; display: none; text-align: center; font-size: 14px; font-weight: 600;">
                <span id="lastUpdatedText">Loading...</span>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="view active">
                <div class="summary-cards">
                    <div class="card">
                        <h3>Total Inventory Value</h3>
                        <div class="value">$<span id="totalValue">0</span></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h3>Low Stock Items</h3>
                        <div class="value"><span id="lowStockCount">0</span></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h3>Items Tracked</h3>
                        <div class="value"><span id="itemCount">0</span></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                        <h3>ü•õ Total Milk (gal)</h3>
                        <div class="value"><span id="totalMilk">0</span></div>
                    </div>
                </div>

                <div id="fridayAlert"></div>

                <!-- Milk Status Summary -->
                <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3 style="color: #333; margin-bottom: 15px;">ü•õ Kroger Milk Status</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 13px; color: #666; margin-bottom: 5px;">2% Milk</div>
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;"><span id="milk2Percent">0</span> gal</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">Par: 25 gal</div>
                            <div id="milk2Status" style="margin-top: 5px;"></div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 13px; color: #666; margin-bottom: 5px;">Skim Milk</div>
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;"><span id="milkSkim">0</span> gal</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">Par: 8 gal</div>
                            <div id="milkSkimStatus" style="margin-top: 5px;"></div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 6px;">
                            <div style="font-size: 13px; color: #666; margin-bottom: 5px;">Whole Milk</div>
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;"><span id="milkWhole">0</span> gal</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">Par: 5 gal</div>
                            <div id="milkWholeStatus" style="margin-top: 5px;"></div>
                        </div>
                    </div>
                </div>

                <div id="countReminder"></div>
                <div id="missedCountAlert"></div>

                <div class="controls">
                    <button class="large" onclick="switchView('dailyCount'); startInventoryCount();">üìã Start Inventory Count</button>
                    <button class="secondary" onclick="switchView('smartOrder')">üéØ Smart Order Budget</button>
                    <button class="secondary" onclick="switchView('orderSheet')">üìß Order Sheet</button>
                    <button class="secondary" onclick="switchView('cogsGap')">üìä COGS Gap</button>
                    <button class="success" onclick="showAddItemForm()" style="margin-left: auto;">‚ûï Add New Item</button>
                </div>

                <!-- Add New Item Form (Hidden by default) -->
                <div id="addItemForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #28a745;">
                    <h3 style="color: #333; margin-bottom: 15px;">‚ûï Request New Inventory Item</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Fill out this form to request a new item. The owner will review and approve it.</p>

                    <div class="form-group">
                        <label>Item Name:</label>
                        <input type="text" id="newItemName" placeholder="e.g., Pumpkin Spice Syrup 1L">
                    </div>

                    <div class="form-group">
                        <label>Item Code (if known):</label>
                        <input type="text" id="newItemCode" placeholder="e.g., 102XXX (optional)">
                    </div>

                    <div class="form-group">
                        <label>Supplier:</label>
                        <select id="newItemSupplier">
                            <option value="Harvest">Harvest Roasting</option>
                            <option value="Kroger">Kroger</option>
                            <option value="Other">Other (specify in notes)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Estimated Cost:</label>
                        <input type="number" id="newItemCost" placeholder="e.g., 8.50" step="0.01">
                    </div>

                    <div class="form-group">
                        <label>Category:</label>
                        <select id="newItemCategory">
                            <option value="Beverages">Beverages</option>
                            <option value="Coffee">Coffee</option>
                            <option value="Cups & Lids">Cups & Lids</option>
                            <option value="Dairy & Cream">Dairy & Cream</option>
                            <option value="Syrups & Sauces">Syrups & Sauces</option>
                            <option value="Food">Food</option>
                            <option value="Supplies">Supplies</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Unit Type:</label>
                        <select id="newItemUnit">
                            <option value="case">Case</option>
                            <option value="each">Each</option>
                            <option value="gallon">Gallon</option>
                            <option value="lb">Pound</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Notes (optional):</label>
                        <textarea id="newItemNotes" rows="3" placeholder="e.g., Need for seasonal menu, currently ordering from..."></textarea>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button class="success" onclick="submitNewItem()">üì§ Submit Request</button>
                        <button class="secondary" onclick="cancelAddItem()">Cancel</button>
                    </div>
                </div>

                <div id="inventoryContainer"></div>
            </div>

            <!-- Inventory Count -->
            <div id="dailyCount" class="view">
                <div style="max-width: 800px; margin: 0 auto;">
                    <h2 style="text-align: center;">üìã Inventory Count</h2>
                    <p style="color: #666; margin: 10px 0 20px; text-align: center;">Count twice weekly: Monday & Thursday nights. Takes 15-20 minutes.</p>

                    <div id="countComparison" style="margin: 20px 0;"></div>
                    <div id="countContent"></div>
                </div>
            </div>

            <!-- Order Sheet -->
            <div id="orderSheet" class="view">
                <h2>üìã Weekly Order Sheet</h2>
                <div class="controls">
                    <button onclick="generateOrderSheet()">Generate Order Sheet</button>
                    <button class="success" onclick="emailOrderSheet()">üìß Email Order Sheet</button>
                </div>
                <div id="orderSheetContent"></div>
            </div>

            <!-- Smart Order Budget -->
            <div id="smartOrder" class="view">
                <h2>üéØ Smart Order Budget</h2>

                <!-- Weekly Budget Calculator -->
                <div class="summary-cards">
                    <div class="card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        <h3>Weekly Sales</h3>
                        <div class="value">$<span id="weeklySales">0</span></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <h3>Max Budget (32%)</h3>
                        <div class="value">$<span id="maxBudget">0</span></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h3>Harvest + Kroger Total</h3>
                        <div class="value">$<span id="orderTotal">0</span></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h3>Budget Remaining</h3>
                        <div class="value">$<span id="budgetRemaining">0</span></div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>Set This Week's Sales</h3>
                    <div class="form-group">
                        <label>Weekly Net Sales ($):</label>
                        <input type="number" id="weekSalesInput" placeholder="8750" value="8750">
                        <button onclick="setWeeklySales()" style="margin-top: 10px;">Calculate Budget</button>
                    </div>
                </div>

                <div id="budgetAlert"></div>

                <!-- Kroger Milk Tracker -->
                <div class="milk-box">
                    <h3>ü•õ Kroger Milk Tracker</h3>
                    <p style="margin: 10px 0; font-size: 14px;">Track milk orders separately - ordered Mon & Thu (75 gal/week avg @ $2.59/gal)</p>

                    <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="margin-bottom: 10px;">Add Milk Order</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: end;">
                            <div>
                                <label style="font-size: 13px;">Date:</label>
                                <input type="date" id="milkDate" class="milk-input">
                            </div>
                            <div>
                                <label style="font-size: 13px;">2% Milk (gal):</label>
                                <input type="number" id="milk2Percent" class="milk-input" placeholder="25">
                            </div>
                            <div>
                                <label style="font-size: 13px;">Skim (gal):</label>
                                <input type="number" id="milkSkim" class="milk-input" placeholder="4">
                            </div>
                            <div>
                                <label style="font-size: 13px;">Whole (gal):</label>
                                <input type="number" id="milkWhole" class="milk-input" placeholder="4">
                            </div>
                            <button onclick="addMilkOrder()">Add Order</button>
                        </div>
                    </div>

                    <div style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 8px;">
                        <h4>This Week's Milk Summary</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                            <div style="background: white; padding: 10px; border-radius: 4px;">
                                <div style="font-size: 12px; color: #666;">Total Gallons</div>
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;"><span id="milkTotalGal">0</span> gal</div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 4px;">
                                <div style="font-size: 12px; color: #666;">Weekly Cost</div>
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;">$<span id="milkWeeklyCost">0</span></div>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 4px;">
                                <div style="font-size: 12px; color: #666;">Par Level</div>
                                <div style="font-size: 20px; font-weight: bold;" id="milkParStatus">‚Äî</div>
                            </div>
                        </div>
                    </div>

                    <div id="milkCostComparison" style="margin-top: 15px;"></div>
                    <div id="milkHistory" style="margin-top: 15px;"></div>
                </div>

                <!-- Savings Tracker -->
                <div class="savings-box">
                    <h3>üí∞ Savings This Month</h3>
                    <div class="savings-amount">$<span id="monthlySavings">0</span></div>
                    <p style="font-size: 14px; opacity: 0.9;">Keep ordering at par level to maximize savings!</p>
                </div>

                <!-- Friday Order Assistant -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>üìã Harvest Roasting Order Assistant</h3>
                    <p style="margin: 10px 0; color: #666;">Suggested order based on your par levels. Adjust quantities as needed.</p>

                    <div class="controls">
                        <button onclick="loadSuggestedOrder()">Load Suggested Order</button>
                        <button class="success" onclick="emailSmartOrder()">üìß Email Order to Harvest Roasting</button>
                        <button class="secondary" onclick="saveCurrentOrder()">üíæ Save This Order</button>
                    </div>

                    <div id="smartOrderTable"></div>
                </div>

                <!-- Over-Order Detector -->
                <div id="overOrderAlert"></div>

                <!-- Par Level Reference -->
                <div style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #0c5460;">
                    <h3>üìä Par Levels (Based on Last 3 Orders)</h3>
                    <div id="parLevelsDisplay"></div>
                </div>
            </div>

            <!-- COGS Gap Tracker -->
            <div id="cogsGap" class="view">
                <h2>üìä COGS Gap Tracker</h2>

                <div class="summary-cards">
                    <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h3>This Week's Gap</h3>
                        <div class="value">$<span id="currentGap">0</span></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <h3>Actual COGS %</h3>
                        <div class="value"><span id="currentActual">0</span>%</div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                        <h3>Total Gap (Month)</h3>
                        <div class="value">$<span id="monthGap">0</span></div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>Add Weekly COGS Data</h3>
                    <div class="form-group">
                        <label>Week Ending Date:</label>
                        <input type="date" id="weekDate">
                    </div>
                    <div class="form-group">
                        <label>Net Sales ($):</label>
                        <input type="number" id="netSales" placeholder="35000">
                    </div>
                    <div class="form-group">
                        <label>Theoretical COGS % (from Power BI):</label>
                        <input type="number" step="0.01" id="theoreticalCOGS" placeholder="32.16">
                    </div>
                    <div class="form-group">
                        <label>Actual COGS %:</label>
                        <input type="number" step="0.01" id="actualCOGS" placeholder="45.00">
                    </div>
                    <div class="form-group">
                        <label>Category with Biggest Issues:</label>
                        <select id="categoryIssue">
                            <option value="">Select category...</option>
                            <option value="Beverages">Beverages</option>
                            <option value="Food">Food</option>
                            <option value="Supplies">Supplies</option>
                            <option value="Waste">Waste/Comps</option>
                            <option value="Theft">Theft/Shrinkage</option>
                        </select>
                    </div>
                    <button onclick="addCOGSEntry()">Add COGS Entry</button>
                </div>

                <div id="cogsGapDisplay"></div>

                <div class="checklist">
                    <h3>üìã Daily Manager Checklist</h3>
                    <div class="checklist-item">
                        <input type="checkbox" id="check1">
                        <label for="check1">All employee drinks rung in correctly?</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check2">
                        <label for="check2">Food pulled correctly with no waste?</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check3">
                        <label for="check3">Waste log completed and reviewed?</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check4">
                        <label for="check4">Compared theoretical vs actual in Power BI?</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check5">
                        <label for="check5">Checked for comps or voids today?</label>
                    </div>
                </div>

                <div class="controls">
                    <button class="success" onclick="emailCOGSSummary()">üìß Email Weekly COGS Summary</button>
                </div>

                <div id="cogsHistory"></div>
            </div>

            <!-- Menu Profitability Tracker -->
            <div id="menuProfit" class="view">
                <h2>üí∞ Menu Profitability Tracker</h2>

                <div class="recommendation-box">
                    <h3>üéØ What To Push Today</h3>
                    <div id="pushRecommendation"></div>
                </div>

                <div class="summary-cards">
                    <div class="card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        <h3>Best Margin Item</h3>
                        <div id="bestItem" style="font-size: 14px; margin-top: 10px;"></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);">
                        <h3>Worst Margin Item</h3>
                        <div id="worstItem" style="font-size: 14px; margin-top: 10px;"></div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h3>Avg COGS %</h3>
                        <div class="value"><span id="avgCOGS">0</span>%</div>
                    </div>
                </div>

                <div style="margin: 20px 0; padding: 15px; background: #d1ecf1; border-left: 4px solid #0c5460; border-radius: 4px;">
                    <strong>üí° Weekly Tip:</strong> <span id="weeklyTip"></span>
                </div>

                <h3 style="margin: 30px 0 15px;">Menu Items by Profitability</h3>
                <div id="menuItemsDisplay"></div>
            </div>

            <!-- Settings -->
            <div id="settings" class="view">
                <h2>‚öôÔ∏è Settings</h2>

                <div class="alert-box" style="background: #e7f3ff; border-left: 4px solid #0c5460; color: #004085; margin-bottom: 20px;">
                    <h3 style="color: #004085;">‚òÅÔ∏è Real-Time Cloud Sync Enabled</h3>
                    <p style="margin: 5px 0; font-size: 14px;">All managers see the same inventory data instantly. Changes sync across all devices automatically!</p>
                </div>

                <div class="form-group">
                    <label>Your Name (for tracking updates):</label>
                    <input type="text" id="managerName" placeholder="Enter first name or initials">
                    <button onclick="changeManagerName()" style="margin-top: 5px; padding: 8px 16px; font-size: 13px;">Update Name</button>
                </div>

                <div class="form-group">
                    <label>Store Email:</label>
                    <input type="email" id="storeEmail" value="store2106@gmail.com">
                </div>

                <div class="form-group">
                    <label>Manager Emails (comma-separated):</label>
                    <textarea id="managerEmails" rows="3">newgardcg@gmail.com</textarea>
                </div>

                <button onclick="saveSettings()">üíæ Save Settings</button>

                <!-- Pending Items Approval Section -->
                <div id="pendingItemsSection" style="margin-top: 30px; display: none;">
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; border-radius: 8px;">
                        <h3 style="color: #856404; margin-bottom: 15px;">‚è≥ Pending Item Requests</h3>
                        <p style="color: #856404; font-size: 14px; margin-bottom: 15px;">Review and approve new items requested by managers.</p>
                        <div id="pendingItemsList"></div>
                    </div>
                </div>

                <div class="alert-box alert-success" style="margin-top: 30px;">
                    <h3>üì± Share This App</h3>
                    <p style="margin-bottom: 10px;">URL: <strong>https://newgardcg.github.io/scooters-inventory/</strong></p>
                    <p style="margin-top: 15px; font-size: 14px;">
                        Text this URL to your managers. All prices are from Harvest Roasting invoices!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // REAL HARVEST ROASTING INVENTORY
        let inventory = {
            "Beverages": [
                { name: "Oat Milk 32oz/12ct", itemCode: "100209", unit: "case", cost: 25.50, minLevel: 2, quantity: 0 },
                { name: "Almond Milk 32oz/12ct", itemCode: "100210", unit: "case", cost: 25.50, minLevel: 2, quantity: 0 },
                { name: "Coconut Milk 32oz/12ct", itemCode: "100211", unit: "case", cost: 34.50, minLevel: 1, quantity: 0 },
                { name: "Strawberry Smoothie 6ct", itemCode: "100159", unit: "case", cost: 45.00, minLevel: 1, quantity: 0 },
                { name: "Mango Smoothie 6ct", itemCode: "100160", unit: "case", cost: 41.65, minLevel: 1, quantity: 0 },
                { name: "Strawberry Banana Smoothie 6ct", itemCode: "100182", unit: "case", cost: 45.00, minLevel: 1, quantity: 0 },
                { name: "Red Bull Regular 24ct", itemCode: "100792", unit: "case", cost: 31.90, minLevel: 2, quantity: 0 },
                { name: "Red Bull Tropical 24ct", itemCode: "100793", unit: "case", cost: 31.90, minLevel: 1, quantity: 0 },
                { name: "Red Bull Sugar Free 24ct", itemCode: "100794", unit: "case", cost: 31.90, minLevel: 1, quantity: 0 },
                { name: "Red Bull Iced Vanilla Berry 24ct", itemCode: "102242", unit: "case", cost: 33.55, minLevel: 1, quantity: 0 },
                { name: "Sparkling Water 12ct", itemCode: "102232", unit: "case", cost: 4.80, minLevel: 2, quantity: 0 },
                { name: "Bottled Water 24ct", itemCode: "100283", unit: "case", cost: 11.50, minLevel: 3, quantity: 0 },
                { name: "Lemonade 12ct", itemCode: "100619", unit: "case", cost: 46.10, minLevel: 1, quantity: 0 },
                { name: "Green Tea 36ct", itemCode: "100233", unit: "case", cost: 32.00, minLevel: 1, quantity: 0 },
                { name: "Sweet Tea 12ct", itemCode: "100801", unit: "case", cost: 35.00, minLevel: 1, quantity: 0 }
            ],
            "Coffee": [
                { name: "Scooters Blend Whole Beans 5lb/2ct", itemCode: "100528", unit: "case", cost: 117.00, minLevel: 1, quantity: 0 },
                { name: "Espresso Whole Beans 5lb/4ct", itemCode: "100578", unit: "case", cost: 235.00, minLevel: 1, quantity: 0 },
                { name: "Dark Roast Whole Beans 2lb/2ct", itemCode: "102275", unit: "case", cost: 47.90, minLevel: 1, quantity: 0 },
                { name: "House Cold Brew 5lb/2ct", itemCode: "100568", unit: "case", cost: 117.00, minLevel: 1, quantity: 0 },
                { name: "French Vanilla Whole Beans 2lb/2ct", itemCode: "102278", unit: "case", cost: 47.90, minLevel: 1, quantity: 0 },
                { name: "Caramelicious Whole Beans 3lb", itemCode: "100560", unit: "each", cost: 35.95, minLevel: 2, quantity: 0 },
                { name: "Scooter Doodle Whole Beans 2lb/2ct", itemCode: "102279", unit: "case", cost: 47.90, minLevel: 1, quantity: 0 },
                { name: "Dark Roast Blend Whole Beans 3lb", itemCode: "100526", unit: "each", cost: 35.95, minLevel: 2, quantity: 0 }
            ],
            "Cups & Lids": [
                // COLD CUPS
                { name: "Kid's Cold Cup 12oz/1000ct", itemCode: "100214", unit: "case", cost: 82.00, minLevel: 1, quantity: 0 },
                { name: "Small Smiley Cold Cup 16oz/700ct", itemCode: "101621", unit: "case", cost: 81.00, minLevel: 1, quantity: 0 },
                { name: "Medium Smiley Cold Cup 20oz/600ct", itemCode: "101622", unit: "case", cost: 77.00, minLevel: 1, quantity: 0 },
                { name: "Large Smiley Cold Cup 24oz/600ct", itemCode: "100082", unit: "case", cost: 125.00, minLevel: 1, quantity: 0 },
                { name: "XL Cold Cup 32oz/270ct", itemCode: "100169", unit: "case", cost: 70.00, minLevel: 1, quantity: 0 },
                // HOT CUPS
                { name: "Sample Cup Hot 4oz/48ct", itemCode: "100192", unit: "case", cost: 3.75, minLevel: 1, quantity: 0 },
                { name: "Small Smiley Hot Cup 12oz/600ct", itemCode: "100799", unit: "case", cost: 76.00, minLevel: 1, quantity: 0 },
                { name: "Medium Smiley Hot Cup 16oz/384ct", itemCode: "100195", unit: "case", cost: 49.50, minLevel: 1, quantity: 0 },
                { name: "Large Smiley Hot Cup 20oz/312ct", itemCode: "100196", unit: "case", cost: 46.75, minLevel: 1, quantity: 0 },
                { name: "XL Hot Cup 24oz/280ct", itemCode: "100177", unit: "case", cost: 60.00, minLevel: 1, quantity: 0 },
                // LIDS
                { name: "Red Lid 1000ct", itemCode: "100193", unit: "case", cost: 35.78, minLevel: 2, quantity: 0 },
                { name: "Sip Lid 1080ct", itemCode: "100281", unit: "case", cost: 44.75, minLevel: 2, quantity: 0 },
                { name: "Flat Lid 1000ct", itemCode: "100357", unit: "case", cost: 34.00, minLevel: 2, quantity: 0 },
                { name: "Dome Lid 1000ct", itemCode: "100358", unit: "case", cost: 50.50, minLevel: 2, quantity: 0 },
                { name: "XL Dome Lid 975ct", itemCode: "100248", unit: "case", cost: 65.00, minLevel: 1, quantity: 0 },
                { name: "XL Flat Lid 1000ct", itemCode: "100047", unit: "case", cost: 65.00, minLevel: 1, quantity: 0 },
                { name: "XL Sip Lid 900ct", itemCode: "100344", unit: "case", cost: 65.00, minLevel: 1, quantity: 0 },
                // STRAWS
                { name: "Red Straw 1800ct", itemCode: "100013", unit: "case", cost: 25.00, minLevel: 2, quantity: 0 },
                { name: "Kid's Flex Straw 400ct", itemCode: "101627", unit: "case", cost: 5.00, minLevel: 1, quantity: 0 },
                { name: "Sample Straw 100ct", itemCode: "100465", unit: "case", cost: 3.72, minLevel: 1, quantity: 0 },
                { name: "Scooter's Drink Stopper 4000ct", itemCode: "100011", unit: "case", cost: 68.00, minLevel: 1, quantity: 0 },
                { name: "Stir Straw 10,000ct", itemCode: "101973", unit: "case", cost: 24.00, minLevel: 1, quantity: 0 }
            ],
            "Dairy & Cream": [
                { name: "2% Reduced Fat Milk 1gal (Kroger)", itemCode: "KRO-2PCT", unit: "gallon", cost: 2.59, minLevel: 25, quantity: 0, supplier: "Kroger" },
                { name: "Skim Milk 1gal (Kroger)", itemCode: "KRO-SKIM", unit: "gallon", cost: 2.59, minLevel: 8, quantity: 0, supplier: "Kroger" },
                { name: "Whole Milk 1gal (Kroger)", itemCode: "KRO-WHOLE", unit: "gallon", cost: 2.59, minLevel: 5, quantity: 0, supplier: "Kroger" },
                { name: "Whipped Cream 12ct/15oz", itemCode: "100515", unit: "case", cost: 45.15, minLevel: 2, quantity: 0, supplier: "Harvest" },
                { name: "Heavy Ice Cream Base 0.5gal/9ct", itemCode: "100729", unit: "case", cost: 54.10, minLevel: 1, quantity: 0, supplier: "Harvest" }
            ],
            "Syrups & Sauces": [
                { name: "Vanilla Syrup 64oz/4ct", itemCode: "100251", unit: "case", cost: 45.75, minLevel: 2, quantity: 0 },
                { name: "Caramel Sauce 64oz/4ct", itemCode: "100254", unit: "case", cost: 46.75, minLevel: 2, quantity: 0 },
                { name: "Mocha Sauce 64oz/4ct", itemCode: "100252", unit: "case", cost: 43.50, minLevel: 2, quantity: 0 },
                { name: "White Mocha Sauce 64oz/4ct", itemCode: "100255", unit: "case", cost: 46.75, minLevel: 2, quantity: 0 },
                { name: "Chai Syrup 64oz/4ct", itemCode: "100435", unit: "case", cost: 51.93, minLevel: 1, quantity: 0 },
                { name: "Chai Syrup 1L/4ct", itemCode: "102269", unit: "case", cost: 27.45, minLevel: 1, quantity: 0 },
                { name: "Strawberry Syrup 1L/4ct", itemCode: "102090", unit: "case", cost: 31.84, minLevel: 1, quantity: 0 },
                { name: "Salted Caramel Syrup 1L/4ct", itemCode: "102164", unit: "case", cost: 31.84, minLevel: 1, quantity: 0 },
                { name: "Hazelnut Syrup 1L/4ct", itemCode: "100426", unit: "case", cost: 31.84, minLevel: 1, quantity: 0 },
                { name: "Pomegranate Peach Syrup 1L/4ct", itemCode: "102089", unit: "case", cost: 35.84, minLevel: 1, quantity: 0 },
                { name: "Blue Raspberry Syrup 1L/4ct", itemCode: "102091", unit: "case", cost: 35.84, minLevel: 1, quantity: 0 },
                { name: "Honey Syrup 750ml/4ct", itemCode: "102149", unit: "case", cost: 23.25, minLevel: 1, quantity: 0 },
                { name: "Brown Butter Syrup 1L", itemCode: "102155", unit: "each", cost: 8.96, minLevel: 2, quantity: 0 },
                { name: "Banana Bread Syrup 750ml", itemCode: "102202", unit: "each", cost: 6.75, minLevel: 2, quantity: 0 },
                { name: "Honey 2lb", itemCode: "100276", unit: "each", cost: 11.50, minLevel: 2, quantity: 0 },
                { name: "Sugar Free White Mocha 64oz", itemCode: "102180", unit: "each", cost: 16.00, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Hazelnut Syrup 1L", itemCode: "102251", unit: "each", cost: 8.00, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Strawberry Syrup 1L", itemCode: "100780", unit: "each", cost: 7.96, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Caramel Sauce 64oz", itemCode: "101221", unit: "each", cost: 16.00, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Mocha Sauce 64oz", itemCode: "100259", unit: "each", cost: 13.34, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Blue Raspberry 1L", itemCode: "102150", unit: "each", cost: 7.96, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Desert Pear 1L", itemCode: "102244", unit: "each", cost: 7.96, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Coconut 1L", itemCode: "102247", unit: "each", cost: 7.96, minLevel: 1, quantity: 0 },
                { name: "Sugar Free Caramel 1L", itemCode: "102249", unit: "each", cost: 8.00, minLevel: 1, quantity: 0 }
            ],
            "Food": [
                { name: "Everything Bagel Spicy Sausage 24ct", itemCode: "100144", unit: "case", cost: 50.99, minLevel: 1, quantity: 0 },
                { name: "Maple Waffle Sandwich 24ct", itemCode: "100145", unit: "case", cost: 50.99, minLevel: 1, quantity: 0 },
                { name: "Ciabatta Bacon Egg Gouda 24ct", itemCode: "100345", unit: "case", cost: 52.53, minLevel: 1, quantity: 0 },
                { name: "French Toastie Sandwich 24ct", itemCode: "102224", unit: "case", cost: 71.50, minLevel: 1, quantity: 0 },
                { name: "Cinnamon Roll 15ct", itemCode: "100532", unit: "case", cost: 14.25, minLevel: 1, quantity: 0 },
                { name: "Cinnamon Roll Icing 9lb", itemCode: "100154", unit: "each", cost: 38.95, minLevel: 1, quantity: 0 },
                { name: "Mini Blueberry Muffins 90ct", itemCode: "100747", unit: "case", cost: 37.00, minLevel: 1, quantity: 0 },
                { name: "Banana Streusel Muffins 32ct", itemCode: "102215", unit: "case", cost: 45.00, minLevel: 1, quantity: 0 },
                { name: "Oreo Cake Bite 18ct", itemCode: "100520", unit: "case", cost: 22.80, minLevel: 1, quantity: 0 },
                { name: "Red Velvet Cake Bite 18ct", itemCode: "100810", unit: "case", cost: 22.80, minLevel: 1, quantity: 0 },
                { name: "Birthday Cake Bite 18ct", itemCode: "100534", unit: "case", cost: 22.80, minLevel: 1, quantity: 0 },
                { name: "Mini Chocolate Chip Cookie 6lb", itemCode: "102118", unit: "case", cost: 40.00, minLevel: 1, quantity: 0 },
                { name: "Mini Donut 312ct", itemCode: "100284", unit: "case", cost: 34.00, minLevel: 1, quantity: 0 },
                { name: "Burrito Bacon Egg Cheese 36ct", itemCode: "100763", unit: "case", cost: 68.25, minLevel: 1, quantity: 0 },
                { name: "Burrito Sausage Egg Cheese 36ct", itemCode: "100764", unit: "case", cost: 68.25, minLevel: 1, quantity: 0 },
                { name: "Tomato Feta Egg Bites 32ct", itemCode: "100765", unit: "case", cost: 109.45, minLevel: 1, quantity: 0 },
                { name: "Bacon Gouda Egg Bites 32ct", itemCode: "100766", unit: "case", cost: 109.45, minLevel: 1, quantity: 0 },
                { name: "Picante Sauce 200ct", itemCode: "100241", unit: "case", cost: 16.55, minLevel: 1, quantity: 0 }
            ],
            "Toppings": [
                { name: "Matcha 1lb", itemCode: "100436", unit: "each", cost: 20.78, minLevel: 2, quantity: 0 },
                { name: "Protein Powder 5lb", itemCode: "100518", unit: "each", cost: 58.00, minLevel: 1, quantity: 0 },
                { name: "Strawberry Dessert Drizzle 12oz", itemCode: "101950", unit: "each", cost: 4.05, minLevel: 2, quantity: 0 },
                { name: "Cinnamon Dessert Drizzle 12oz", itemCode: "102152", unit: "each", cost: 4.05, minLevel: 2, quantity: 0 },
                { name: "Oreo Cookie Crumbs 12lb", itemCode: "102252", unit: "case", cost: 65.00, minLevel: 1, quantity: 0 }
            ],
            "Supplies": [
                { name: "Scooters Napkins 6000ct", itemCode: "100236", unit: "case", cost: 86.76, minLevel: 1, quantity: 0 },
                { name: "Spring Lid Sticker 7500ct", itemCode: "102281", unit: "each", cost: 10.75, minLevel: 2, quantity: 0 },
                { name: "No Rinse Floor Cleaner 1gal", itemCode: "100046", unit: "each", cost: 7.75, minLevel: 2, quantity: 0 },
                { name: "Franke Milk Cleaner 1L", itemCode: "100062", unit: "each", cost: 20.68, minLevel: 1, quantity: 0 },
                { name: "Franke Cleaning Tablets 100ct", itemCode: "100063", unit: "each", cost: 17.85, minLevel: 1, quantity: 0 },
                { name: "Disinfectant Wipes 160ct", itemCode: "100221", unit: "each", cost: 10.68, minLevel: 2, quantity: 0 },
                { name: "Vinyl Gloves XL 100ct", itemCode: "100375", unit: "each", cost: 8.98, minLevel: 3, quantity: 0 },
                { name: "Hand Soap Refill 1gal", itemCode: "100075", unit: "each", cost: 10.69, minLevel: 2, quantity: 0 }
            ]
        };

        // PAR LEVELS based on last 3 orders
        let parLevels = {
            "100209": { name: "Oat Milk 32oz/12ct", parQty: 3, unit: "case", variance: "Low", history: [3, 3, 2] },
            "100210": { name: "Almond Milk 32oz/12ct", parQty: 2, unit: "case", variance: "Low", history: [1, 3, 2] },
            "100211": { name: "Coconut Milk 32oz/12ct", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 0] },
            "100793": { name: "Red Bull Tropical 24ct", parQty: 3, unit: "case", variance: "Low", history: [3, 4, 3] },
            "100794": { name: "Red Bull Sugar Free 24ct", parQty: 2, unit: "case", variance: "Low", history: [2, 2, 1] },
            "102232": { name: "Sparkling Water 12ct", parQty: 2, unit: "case", variance: "Medium", history: [1, 2, 3] },
            "100528": { name: "Scooters Blend Whole Beans 5lb/2ct", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 0] },
            "100578": { name: "Espresso Whole Beans 5lb/4ct", parQty: 1, unit: "case", variance: "Medium", history: [0, 2, 2] },
            "102275": { name: "Dark Roast Whole Beans 2lb/2ct", parQty: 1, unit: "case", variance: "High", history: [1, 2, 0] },
            "100568": { name: "House Cold Brew 5lb/2ct", parQty: 1, unit: "case", variance: "Low", history: [0, 1, 1] },
            "100251": { name: "Vanilla Syrup 64oz/4ct", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 0] },
            "100254": { name: "Caramel Sauce 64oz/4ct", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 1] },
            "100435": { name: "Chai Syrup 64oz/4ct", parQty: 1, unit: "case", variance: "Medium", history: [1, 0, 1] },
            "102090": { name: "Strawberry Syrup 1L/4ct", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 0] },
            "100436": { name: "Matcha 1lb", parQty: 3, unit: "each", variance: "Low", history: [3, 2, 3] },
            "100729": { name: "Heavy Ice Cream Base 0.5gal/9ct", parQty: 2, unit: "case", variance: "Medium", history: [1, 2, 3] },
            "100144": { name: "Everything Bagel Spicy Sausage 24ct", parQty: 2, unit: "case", variance: "Low", history: [2, 1, 2] },
            "100145": { name: "Maple Waffle Sandwich 24ct", parQty: 1, unit: "case", variance: "Medium", history: [2, 2, 0] },
            "100345": { name: "Ciabatta Bacon Egg Gouda 24ct", parQty: 1, unit: "case", variance: "Medium", history: [2, 2, 0] },
            "102224": { name: "French Toastie Sandwich 24ct", parQty: 1, unit: "case", variance: "High", history: [0, 0, 2] },
            "100532": { name: "Cinnamon Roll 15ct", parQty: 2, unit: "case", variance: "High", history: [2, 0, 3] },
            "100747": { name: "Mini Blueberry Muffins 90ct", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 1] },
            "102215": { name: "Banana Streusel Muffins 32ct", parQty: 1, unit: "case", variance: "Medium", history: [2, 1, 0] },
            "100520": { name: "Oreo Cake Bite 18ct", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 1] },
            "102118": { name: "Mini Chocolate Chip Cookie 6lb", parQty: 1, unit: "case", variance: "Low", history: [1, 1, 2] },
            "100765": { name: "Tomato Feta Egg Bites 32ct", parQty: 1, unit: "case", variance: "Low", history: [0, 1, 1] },
            "100766": { name: "Bacon Gouda Egg Bites 32ct", parQty: 1, unit: "case", variance: "High", history: [0, 2, 0] },
            "100764": { name: "Burrito Sausage Egg Cheese 36ct", parQty: 1, unit: "case", variance: "Low", history: [0, 2, 1] }
        };

        // MILK TRACKING
        const KROGER_MILK_PRICE = 2.59;
        const HARVEST_MILK_PRICE = 4.50; // Estimated if buying from Harvest
        let milkOrders = [];

        // Milk par levels (75 gal/week total)
        const milkParLevels = {
            twoPercent: 50,
            skim: 15,
            whole: 10,
            total: 75
        };

        // REAL MENU ITEMS FROM BRINK POWER BI - January 2026
        let menuItems = [
            { name: "MED Iced Flavored Latte", sales: 448, cogs: 21.61, price: 5.50 },
            { name: "Extra Shot", sales: 516, cogs: 21.45, price: 0.75 },
            { name: "MED Flavored Latte", sales: 737, cogs: 23.05, price: 5.50 },
            { name: "LRG Iced Flavored Latte", sales: 316, cogs: 23.25, price: 6.50 },
            { name: "LRG Flavored Latte", sales: 574, cogs: 23.60, price: 6.50 },
            { name: "MED Banana Bread Latte", sales: 341, cogs: 24.88, price: 5.75 },
            { name: "LRG White Mocha", sales: 295, cogs: 25.97, price: 6.75 },
            { name: "SML Oreo Blender", sales: 295, cogs: 26.14, price: 5.00 },
            { name: "MED Iced Cinnalicious", sales: 334, cogs: 26.20, price: 5.50 },
            { name: "MED Iced Caramelicious", sales: 386, cogs: 26.38, price: 5.50 },
            { name: "MED Blended Caramelicious", sales: 353, cogs: 27.34, price: 5.75 },
            { name: "MED Cinnalicious", sales: 322, cogs: 27.60, price: 5.50 },
            { name: "Caramelicious", sales: 532, cogs: 27.86, price: 5.50 },
            { name: "LRG Caramelicious", sales: 399, cogs: 28.32, price: 6.50 },
            { name: "MED Oreo Blender", sales: 323, cogs: 32.02, price: 5.75 },
            { name: "Cinnamon Roll", sales: 378, cogs: 42.74, price: 3.50 },
            { name: "Maple Waffle Sandwich", sales: 1053, cogs: 43.88, price: 5.99 },
            { name: "Everything Bagel Sandwich", sales: 636, cogs: 43.88, price: 5.99 },
            { name: "Bacon Breakfast Sandwich", sales: 588, cogs: 45.15, price: 5.49 },
            { name: "Mini Chocolate Chip Cookies", sales: 327, cogs: 47.75, price: 2.99 },
            { name: "Sausage Burrito", sales: 787, cogs: 48.82, price: 4.99 },
            { name: "Bacon Burrito", sales: 489, cogs: 48.82, price: 4.99 },
            { name: "French Toastie", sales: 512, cogs: 52.03, price: 5.99 },
            { name: "Bacon Gouda Egg Bites", sales: 446, cogs: 67.81, price: 4.99 },
            { name: "Tomato Feta Egg Bites", sales: 348, cogs: 67.81, price: 4.99 }
        ];

        let cogsData = [];
        let orderHistory = [];
        let currentOrder = {};
        let weeklySales = 8750;
        let monthlySavings = 0;

        let settings = {
            storeEmail: 'store2106@gmail.com',
            managerEmails: 'newgardcg@gmail.com'
        };

        let countIndex = 0;
        let countItems = [];
        let countHistory = []; // Stores Monday and Thursday count records
        let pendingItems = []; // Items awaiting approval

        // ============================================================================
        // UNIT CONVERSION SYSTEM - Count individually, order by case
        // ============================================================================

        // Extract units per case from item name (e.g., "Smoothie 6ct" => 6)
        function getUnitsPerCase(itemName) {
            const match = itemName.match(/(\d+)ct/i);
            return match ? parseInt(match[1]) : 1;
        }

        // Determine if item should be counted individually
        function shouldCountIndividually(item) {
            const individualCategories = ['Food', 'Beverages', 'Syrups & Sauces'];
            const caseCategories = ['Cups & Lids', 'Coffee'];

            // Milk is always counted individually (gallons)
            if (item.supplier === 'Kroger' || item.name.includes('Milk')) {
                return true;
            }

            // Food items with "ct" in name (smoothies, burritos, etc.) count individually
            if (item.name.match(/\d+ct/i) && (individualCategories.some(cat => item.category === cat))) {
                return true;
            }

            return false;
        }

        // Convert individual units to cases
        function individualToCases(individualCount, unitsPerCase) {
            return individualCount / unitsPerCase;
        }

        // Convert cases to individual units
        function casesToIndividual(caseCount, unitsPerCase) {
            return caseCount * unitsPerCase;
        }

        // Get display string for inventory count
        function getCountDisplay(item) {
            if (shouldCountIndividually(item)) {
                const unitsPerCase = getUnitsPerCase(item.name);
                const cases = individualToCases(item.quantity, unitsPerCase);
                return `${item.quantity} units (${cases.toFixed(1)} cases)`;
            }
            return `${item.quantity} ${item.unit}`;
        }

        // ============================================================================
        // FIREBASE REAL-TIME SYNC - All managers see same data!
        // ============================================================================

        // Get or set manager name (stored locally for identification)
        function getManagerName() {
            let managerName = localStorage.getItem('scootersManagerName');
            if (!managerName) {
                managerName = prompt('Enter your name (first name or initials):\n\nThis helps track who updated the inventory.') || 'Manager';
                localStorage.setItem('scootersManagerName', managerName);
            }
            return managerName;
        }

        // Update "Last Updated" banner
        function updateLastUpdatedBanner(managerName, timestamp) {
            const banner = document.getElementById('lastUpdatedBanner');
            const text = document.getElementById('lastUpdatedText');
            if (managerName && timestamp) {
                const date = new Date(timestamp);
                const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                text.textContent = `‚úÖ Last updated by ${managerName} at ${timeStr} on ${dateStr}`;
                banner.style.display = 'block';
            }
        }

        // Save inventory to Firebase with metadata
        function saveInventory() {
            const managerName = getManagerName();
            const timestamp = Date.now();

            database.ref('inventory').set(inventory);
            database.ref('metadata/lastUpdated').set({
                managerName: managerName,
                timestamp: timestamp
            });

            updateDisplay();
        }

        // Save specific data to Firebase
        function saveToFirebase(path, data) {
            const managerName = getManagerName();
            const timestamp = Date.now();

            database.ref(path).set(data);
            database.ref('metadata/lastUpdated').set({
                managerName: managerName,
                timestamp: timestamp
            });
        }

        // Load data from Firebase with real-time sync
        function loadData() {
            // Real-time listener for inventory data
            database.ref('inventory').on('value', (snapshot) => {
                const savedData = snapshot.val();
                if (savedData) {
                    for (const [category, items] of Object.entries(inventory)) {
                        if (savedData[category]) {
                            items.forEach((item, index) => {
                                if (savedData[category][index]) {
                                    item.quantity = savedData[category][index].quantity || 0;
                                }
                            });
                        }
                    }
                    updateDisplay();
                }
            });

            // Real-time listener for settings
            database.ref('settings').on('value', (snapshot) => {
                const savedSettings = snapshot.val();
                if (savedSettings) {
                    settings = savedSettings;
                    document.getElementById('storeEmail').value = settings.storeEmail || '';
                    document.getElementById('managerEmails').value = settings.managerEmails || '';
                }
            });

            // Real-time listener for COGS data
            database.ref('cogsData').on('value', (snapshot) => {
                const savedCOGS = snapshot.val();
                if (savedCOGS) {
                    cogsData = savedCOGS;
                    updateCOGSDisplay();
                }
            });

            // Real-time listener for order history
            database.ref('orderHistory').on('value', (snapshot) => {
                const savedOrders = snapshot.val();
                if (savedOrders) {
                    orderHistory = savedOrders;
                    updateSmartOrderDisplay();
                }
            });

            // Real-time listener for milk orders
            database.ref('milkOrders').on('value', (snapshot) => {
                const savedMilk = snapshot.val();
                if (savedMilk) {
                    milkOrders = savedMilk;
                }
            });

            // Real-time listener for weekly sales
            database.ref('weeklySales').on('value', (snapshot) => {
                const savedSales = snapshot.val();
                if (savedSales) {
                    weeklySales = parseFloat(savedSales);
                    document.getElementById('weekSalesInput').value = weeklySales;
                }
            });

            // Real-time listener for monthly savings
            database.ref('monthlySavings').on('value', (snapshot) => {
                const savedSavings = snapshot.val();
                if (savedSavings) {
                    monthlySavings = parseFloat(savedSavings);
                }
            });

            // Real-time listener for count history
            database.ref('countHistory').on('value', (snapshot) => {
                const savedCountHistory = snapshot.val();
                if (savedCountHistory) {
                    countHistory = savedCountHistory;
                    checkCountReminders();
                    checkMissedCounts();
                }
            });

            // Real-time listener for pending items
            database.ref('pendingItems').on('value', (snapshot) => {
                const savedPending = snapshot.val();
                if (savedPending) {
                    pendingItems = savedPending;
                    displayPendingItems();
                }
            });

            // Real-time listener for last updated metadata
            database.ref('metadata/lastUpdated').on('value', (snapshot) => {
                const metadata = snapshot.val();
                if (metadata) {
                    updateLastUpdatedBanner(metadata.managerName, metadata.timestamp);
                }
            });

            // Initial display updates
            updateDisplay();
            updateCOGSDisplay();
            updateMenuDisplay();
            updateSmartOrderDisplay();
            checkFriday();
            checkCountReminders();
            checkMissedCounts();
        }

        function changeManagerName() {
            const newName = document.getElementById('managerName').value.trim();
            if (newName) {
                localStorage.setItem('scootersManagerName', newName);
                alert(`Name updated to: ${newName}\n\nThis will show when you update inventory.`);
            } else {
                alert('Please enter a name!');
            }
        }

        function saveSettings() {
            settings.storeEmail = document.getElementById('storeEmail').value;
            settings.managerEmails = document.getElementById('managerEmails').value;
            saveToFirebase('settings', settings);
            alert('Settings saved!');
        }

        // ============================================================================
        // ADD NEW ITEM SYSTEM
        // ============================================================================

        function showAddItemForm() {
            document.getElementById('addItemForm').style.display = 'block';
            document.getElementById('addItemForm').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelAddItem() {
            document.getElementById('addItemForm').style.display = 'none';
            // Clear form
            document.getElementById('newItemName').value = '';
            document.getElementById('newItemCode').value = '';
            document.getElementById('newItemCost').value = '';
            document.getElementById('newItemNotes').value = '';
        }

        function submitNewItem() {
            const managerName = getManagerName();
            const itemName = document.getElementById('newItemName').value.trim();
            const itemCode = document.getElementById('newItemCode').value.trim() || 'PENDING';
            const supplier = document.getElementById('newItemSupplier').value;
            const cost = parseFloat(document.getElementById('newItemCost').value) || 0;
            const category = document.getElementById('newItemCategory').value;
            const unit = document.getElementById('newItemUnit').value;
            const notes = document.getElementById('newItemNotes').value.trim();

            if (!itemName || cost <= 0) {
                alert('Please enter item name and cost!');
                return;
            }

            const newItem = {
                name: itemName,
                itemCode: itemCode,
                supplier: supplier,
                cost: cost,
                category: category,
                unit: unit,
                notes: notes,
                requestedBy: managerName,
                timestamp: Date.now(),
                status: 'PENDING'
            };

            // Add to pending items array
            pendingItems.push(newItem);
            saveToFirebase('pendingItems', pendingItems);

            // Send email notification to owner
            const emailSubject = `New Inventory Item Request - ${itemName}`;
            const emailBody = `NEW INVENTORY ITEM REQUEST\n\nRequested by: ${managerName}\nDate: ${new Date().toLocaleDateString()}\n\n` +
                `Item Name: ${itemName}\nItem Code: ${itemCode}\nSupplier: ${supplier}\nCategory: ${category}\n` +
                `Unit: ${unit}\nEstimated Cost: $${cost.toFixed(2)}\n\nNotes: ${notes}\n\n` +
                `Review and approve at: https://newgardcg.github.io/scooters-inventory/ ‚Üí Settings tab`;

            window.open(`mailto:newgardcg@gmail.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`);

            alert(`‚úÖ Item request submitted!\n\nAn email has been opened to notify the owner.\nPlease click "Send" to complete the request.`);
            cancelAddItem();
        }

        // Load and display pending items in Settings
        function displayPendingItems() {
            const section = document.getElementById('pendingItemsSection');
            const list = document.getElementById('pendingItemsList');

            if (!pendingItems || pendingItems.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            let html = '';

            pendingItems.forEach((item, index) => {
                html += `
                    <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 10px; border-left: 3px solid #ffc107;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h4 style="color: #333; margin-bottom: 5px;">${item.name}</h4>
                                <p style="font-size: 13px; color: #666; margin: 3px 0;">
                                    <strong>Code:</strong> ${item.itemCode} |
                                    <strong>Supplier:</strong> ${item.supplier} |
                                    <strong>Cost:</strong> $${item.cost.toFixed(2)} |
                                    <strong>Category:</strong> ${item.category}
                                </p>
                                <p style="font-size: 13px; color: #666; margin: 3px 0;">
                                    <strong>Requested by:</strong> ${item.requestedBy} on ${new Date(item.timestamp).toLocaleDateString()}
                                </p>
                                ${item.notes ? `<p style="font-size: 12px; color: #999; margin-top: 5px; font-style: italic;">${item.notes}</p>` : ''}
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button onclick="approveItem(${index})" class="success" style="padding: 6px 12px; font-size: 12px;">‚úì Approve</button>
                                <button onclick="rejectItem(${index})" class="danger" style="padding: 6px 12px; font-size: 12px;">‚úó Reject</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            list.innerHTML = html;
        }

        function approveItem(index) {
            const item = pendingItems[index];
            if (!confirm(`Approve "${item.name}"?\n\nThis will add it to the ${item.category} category.`)) {
                return;
            }

            // Add to inventory
            const newItem = {
                name: item.name,
                itemCode: item.itemCode,
                unit: item.unit,
                cost: item.cost,
                minLevel: 1,
                quantity: 0,
                supplier: item.supplier
            };

            if (!inventory[item.category]) {
                inventory[item.category] = [];
            }
            inventory[item.category].push(newItem);

            // Remove from pending
            pendingItems.splice(index, 1);

            // Save both
            saveInventory();
            saveToFirebase('pendingItems', pendingItems);

            alert(`‚úÖ "${item.name}" has been added to inventory!`);
            displayPendingItems();
        }

        function rejectItem(index) {
            const item = pendingItems[index];
            if (!confirm(`Reject "${item.name}"?\n\nThis will remove the request.`)) {
                return;
            }

            pendingItems.splice(index, 1);
            saveToFirebase('pendingItems', pendingItems);

            alert(`Item request rejected and removed.`);
            displayPendingItems();
        }

        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(viewName).classList.add('active');
            event.target.classList.add('active');
            if (viewName === 'orderSheet') generateOrderSheet();
            if (viewName === 'cogsGap') updateCOGSDisplay();
            if (viewName === 'menuProfit') updateMenuDisplay();
            if (viewName === 'smartOrder') updateSmartOrderDisplay();
            if (viewName === 'settings') {
                const currentName = localStorage.getItem('scootersManagerName');
                if (currentName) {
                    document.getElementById('managerName').value = currentName;
                }
                displayPendingItems();
            }
        }

        function updateDisplay() {
            const container = document.getElementById('inventoryContainer');
            container.innerHTML = '';
            let totalValue = 0, lowStockCount = 0, itemCount = 0;

            for (const [category, items] of Object.entries(inventory)) {
                itemCount += items.length;
                const section = document.createElement('div');
                section.innerHTML = `<h3 style="background: #f8f9fa; padding: 12px; margin: 20px 0 10px; border-left: 4px solid #667eea;">${category}</h3>`;
                const table = document.createElement('table');
                table.innerHTML = '<thead><tr><th>Item</th><th>Item Code</th><th>Count</th><th>Unit</th><th>Cost</th><th>Value</th><th>Status</th></tr></thead><tbody></tbody>';
                const tbody = table.querySelector('tbody');

                items.forEach((item, index) => {
                    // Add category to item for conversion logic
                    item.category = category;

                    const itemValue = item.quantity * item.cost;
                    totalValue += itemValue;
                    let status = 'OK', statusClass = 'status-ok', rowClass = '';
                    if (item.quantity <= item.minLevel / 2) {
                        status = 'CRITICAL'; statusClass = 'status-critical'; rowClass = 'low-stock'; lowStockCount++;
                    } else if (item.quantity <= item.minLevel) {
                        status = 'LOW'; statusClass = 'status-low'; rowClass = 'low-stock'; lowStockCount++;
                    }

                    // Check if this item should show conversion
                    let quantityDisplay = item.quantity;
                    let conversionHint = '';
                    if (shouldCountIndividually(item)) {
                        const unitsPerCase = getUnitsPerCase(item.name);
                        if (unitsPerCase > 1) {
                            const cases = individualToCases(item.quantity, unitsPerCase);
                            conversionHint = `<div style="font-size: 11px; color: #666; margin-top: 2px;">‚âà ${cases.toFixed(1)} cases</div>`;
                        }
                    }

                    const row = document.createElement('tr');
                    row.className = rowClass;
                    row.innerHTML = `
                        <td><strong>${item.name}</strong></td>
                        <td><span class="item-code">${item.itemCode}</span></td>
                        <td><input type="number" value="${item.quantity}" onchange="updateQuantity('${category}', ${index}, this.value)" style="width: 70px; padding: 4px;">${conversionHint}</td>
                        <td>${item.unit}</td>
                        <td>$${item.cost.toFixed(2)}</td>
                        <td><strong>$${itemValue.toFixed(2)}</strong></td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                    `;
                    tbody.appendChild(row);
                });

                section.appendChild(table);
                container.appendChild(section);
            }

            document.getElementById('totalValue').textContent = totalValue.toFixed(2);
            document.getElementById('lowStockCount').textContent = lowStockCount;
            document.getElementById('itemCount').textContent = itemCount;
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            // Update milk status displays
            const dairyCream = inventory["Dairy & Cream"] || [];
            const milk2Percent = dairyCream.find(item => item.itemCode === "KRO-2PCT");
            const milkSkim = dairyCream.find(item => item.itemCode === "KRO-SKIM");
            const milkWhole = dairyCream.find(item => item.itemCode === "KRO-WHOLE");

            let totalMilk = 0;

            if (milk2Percent) {
                document.getElementById('milk2Percent').textContent = milk2Percent.quantity;
                totalMilk += milk2Percent.quantity;
                const status2 = milk2Percent.quantity <= milk2Percent.minLevel / 2 ?
                    '<span class="status-badge status-critical">CRITICAL</span>' :
                    milk2Percent.quantity <= milk2Percent.minLevel ?
                    '<span class="status-badge status-low">LOW</span>' :
                    '<span class="status-badge status-ok">OK</span>';
                document.getElementById('milk2Status').innerHTML = status2;
            }

            if (milkSkim) {
                document.getElementById('milkSkim').textContent = milkSkim.quantity;
                totalMilk += milkSkim.quantity;
                const statusSkim = milkSkim.quantity <= milkSkim.minLevel / 2 ?
                    '<span class="status-badge status-critical">CRITICAL</span>' :
                    milkSkim.quantity <= milkSkim.minLevel ?
                    '<span class="status-badge status-low">LOW</span>' :
                    '<span class="status-badge status-ok">OK</span>';
                document.getElementById('milkSkimStatus').innerHTML = statusSkim;
            }

            if (milkWhole) {
                document.getElementById('milkWhole').textContent = milkWhole.quantity;
                totalMilk += milkWhole.quantity;
                const statusWhole = milkWhole.quantity <= milkWhole.minLevel / 2 ?
                    '<span class="status-badge status-critical">CRITICAL</span>' :
                    milkWhole.quantity <= milkWhole.minLevel ?
                    '<span class="status-badge status-low">LOW</span>' :
                    '<span class="status-badge status-ok">OK</span>';
                document.getElementById('milkWholeStatus').innerHTML = statusWhole;
            }

            document.getElementById('totalMilk').textContent = totalMilk.toFixed(0);
        }

        function updateQuantity(category, index, value) {
            inventory[category][index].quantity = parseFloat(value) || 0;
            saveInventory();
        }

        // Twice-Weekly Inventory Count
        function startInventoryCount() {
            displayCountComparison();
            countItems = [];
            for (const [category, items] of Object.entries(inventory)) {
                items.forEach((item, index) => {
                    countItems.push({ category, index, ...item });
                });
            }
            countIndex = 0;
            showCountItem();
        }

        function displayCountComparison() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const countType = (dayOfWeek === 1 || dayOfWeek === 4) ? (dayOfWeek === 1 ? 'Monday' : 'Thursday') : 'Inventory';

            // Find last count of this type
            const lastCount = countHistory.filter(c => c.countType === countType).sort((a, b) => b.timestamp - a.timestamp)[0];

            const compDiv = document.getElementById('countComparison');
            if (!lastCount) {
                compDiv.innerHTML = `<div class="alert-box alert-success">
                    <h3>üìã ${countType} Count</h3>
                    <p>Starting your ${countType} inventory count. Takes 15-20 minutes.</p>
                </div>`;
                return;
            }

            // Calculate what changed since last count
            const lastDate = new Date(lastCount.timestamp);
            const daysAgo = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));

            compDiv.innerHTML = `<div class="alert-box alert-warning">
                <h3>üìä Comparison to Last ${countType} Count</h3>
                <p style="margin: 10px 0;">Last count was ${daysAgo} days ago (${lastDate.toLocaleDateString()})</p>
                <p style="font-size: 13px; color: #856404;">You'll see how much was used since then after completing this count.</p>
            </div>`;
        }

        function showCountItem() {
            const content = document.getElementById('countContent');
            if (countIndex >= countItems.length) {
                finishInventoryCount();
                return;
            }

            const item = countItems[countIndex];

            // Find last count for this item
            let lastCountValue = '';
            if (countHistory.length > 0) {
                const lastCount = countHistory[countHistory.length - 1];
                if (lastCount.inventory && lastCount.inventory[item.category]) {
                    const lastItem = lastCount.inventory[item.category][item.index];
                    if (lastItem) {
                        lastCountValue = `<div style="color: #999; font-size: 14px; margin-top: 10px;">Last count: ${lastItem.quantity} ${item.unit}</div>`;
                    }
                }
            }

            content.innerHTML = `
                <div style="background: #f8f9fa; padding: 40px; border-radius: 12px; margin: 30px 0;">
                    <div style="color: #666; margin-bottom: 20px;">Item ${countIndex + 1} of ${countItems.length}</div>
                    <h2 style="color: #667eea; font-size: 28px; margin-bottom: 10px;">${item.name}</h2>
                    <p style="color: #999; font-size: 14px; margin-bottom: 20px;">Code: ${item.itemCode} | Unit: ${item.unit}</p>
                    ${lastCountValue}
                    <input type="number" id="countInput" style="font-size: 42px; text-align: center; padding: 20px; margin: 20px 0; border: 3px solid #667eea; border-radius: 8px; width: 100%;" placeholder="0" autofocus>
                    <button class="large" style="width: 100%; margin-top: 10px;" onclick="saveCountAndNext()">Next ‚Üí</button>
                </div>
            `;
            document.getElementById('countInput').focus();
            document.getElementById('countInput').addEventListener('keypress', e => {
                if (e.key === 'Enter') saveCountAndNext();
            });
        }

        function saveCountAndNext() {
            const value = parseFloat(document.getElementById('countInput').value) || 0;
            const item = countItems[countIndex];
            inventory[item.category][item.index].quantity = value;
            countIndex++;
            showCountItem();
        }

        function finishInventoryCount() {
            saveInventory();

            // Save count to history
            const today = new Date();
            const dayOfWeek = today.getDay();
            const countType = (dayOfWeek === 1) ? 'Monday' : (dayOfWeek === 4) ? 'Thursday' : 'Other';

            // Calculate usage since last count
            let usageSummary = '';
            if (countHistory.length > 0) {
                const lastCount = countHistory[countHistory.length - 1];
                const usageItems = [];

                for (const [category, items] of Object.entries(inventory)) {
                    if (lastCount.inventory[category]) {
                        items.forEach((item, index) => {
                            const lastQty = lastCount.inventory[category][index]?.quantity || 0;
                            const currentQty = item.quantity;
                            const used = lastQty - currentQty;
                            if (Math.abs(used) > 0.1) {
                                usageItems.push({
                                    name: item.name,
                                    used: used,
                                    unit: item.unit
                                });
                            }
                        });
                    }
                }

                if (usageItems.length > 0) {
                    usageSummary = '<h4 style="margin-top: 20px;">Usage Since Last Count:</h4><div style="max-height: 300px; overflow-y: auto;"><table style="margin-top: 10px;"><thead><tr><th>Item</th><th>Used</th></tr></thead><tbody>';
                    usageItems.slice(0, 20).forEach(item => {
                        const usedText = item.used > 0 ? `${item.used.toFixed(1)} ${item.unit}` : `Added ${Math.abs(item.used).toFixed(1)} ${item.unit}`;
                        usageSummary += `<tr><td>${item.name}</td><td>${usedText}</td></tr>`;
                    });
                    usageSummary += '</tbody></table></div>';
                }
            }

            countHistory.push({
                timestamp: Date.now(),
                countType: countType,
                date: today.toISOString(),
                inventory: JSON.parse(JSON.stringify(inventory))
            });

            saveToFirebase('countHistory', countHistory);

            document.getElementById('countContent').innerHTML = `
                <div class="alert-box alert-success">
                    <h3>‚úì ${countType} Count Complete!</h3>
                    <p style="margin: 10px 0;">Inventory has been updated and saved.</p>
                    ${usageSummary}
                    <button class="large" onclick="switchView('dashboard')" style="margin-top: 10px;">Back to Dashboard</button>
                </div>
            `;
        }

        // Check for count reminders (Monday & Thursday at 8pm)
        function checkCountReminders() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const hour = now.getHours();
            const reminderDiv = document.getElementById('countReminder');

            // Monday (1) or Thursday (4) after 8pm
            if ((dayOfWeek === 1 || dayOfWeek === 4) && hour >= 20) {
                const countType = dayOfWeek === 1 ? 'Monday' : 'Thursday';

                // Check if already counted today
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const countedToday = countHistory.some(c => {
                    const countDate = new Date(c.timestamp);
                    countDate.setHours(0, 0, 0, 0);
                    return countDate.getTime() === today.getTime() && c.countType === countType;
                });

                if (!countedToday) {
                    reminderDiv.innerHTML = `<div class="alert-box alert-warning" style="animation: pulse 2s infinite;">
                        <h3>‚è∞ ${countType} Inventory Count Due Tonight!</h3>
                        <p style="margin: 10px 0;">Inventory count should be completed before close tonight. Takes 15-20 minutes.</p>
                        <button class="large" onclick="switchView('dailyCount'); startInventoryCount();" style="margin-top: 10px;">Start Count Now ‚Üí</button>
                    </div>`;
                } else {
                    reminderDiv.innerHTML = `<div class="alert-box alert-success">
                        <h3>‚úì ${countType} Count Completed</h3>
                        <p>Thank you! ${countType} inventory count is done.</p>
                    </div>`;
                }
            } else {
                reminderDiv.innerHTML = '';
            }
        }

        // Check for missed counts
        function checkMissedCounts() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const alertDiv = document.getElementById('missedCountAlert');

            // Tuesday - check if Monday count was done
            if (dayOfWeek === 2) {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                yesterday.setHours(0, 0, 0, 0);

                const mondayCountDone = countHistory.some(c => {
                    const countDate = new Date(c.timestamp);
                    countDate.setHours(0, 0, 0, 0);
                    return countDate.getTime() === yesterday.getTime() && c.countType === 'Monday';
                });

                if (!mondayCountDone) {
                    alertDiv.innerHTML = `<div class="alert-box alert-danger">
                        <h3>‚ö†Ô∏è Missed Monday Count!</h3>
                        <p style="margin: 10px 0;">Monday inventory count was not completed. Please count as soon as possible.</p>
                        <button class="large" onclick="switchView('dailyCount'); startInventoryCount();" style="margin-top: 10px;">Start Count Now ‚Üí</button>
                    </div>`;
                    return;
                }
            }

            // Friday - check if Thursday count was done (CRITICAL - needed for ordering)
            if (dayOfWeek === 5) {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                yesterday.setHours(0, 0, 0, 0);

                const thursdayCountDone = countHistory.some(c => {
                    const countDate = new Date(c.timestamp);
                    countDate.setHours(0, 0, 0, 0);
                    return countDate.getTime() === yesterday.getTime() && c.countType === 'Thursday';
                });

                if (!thursdayCountDone) {
                    alertDiv.innerHTML = `<div class="alert-box alert-danger">
                        <h3>üî¥ CRITICAL: Thursday Count Missing!</h3>
                        <p style="margin: 10px 0; font-size: 16px;"><strong>Cannot generate Friday order without Thursday count!</strong></p>
                        <p>Complete inventory count immediately to place today's order.</p>
                        <button class="large danger" onclick="switchView('dailyCount'); startInventoryCount();" style="margin-top: 10px;">START COUNT NOW ‚Üí</button>
                    </div>`;
                    return;
                }
            }

            alertDiv.innerHTML = '';
        }

        // Order Sheet
        function generateOrderSheet() {
            const content = document.getElementById('orderSheetContent');
            const krogerItems = [];
            const harvestItems = [];

            // Check if Thursday count was done
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            yesterday.setHours(0, 0, 0, 0);
            const thursdayCountDone = countHistory.some(c => {
                const countDate = new Date(c.timestamp);
                countDate.setHours(0, 0, 0, 0);
                return countDate.getTime() === yesterday.getTime() && c.countType === 'Thursday';
            });

            for (const [category, items] of Object.entries(inventory)) {
                items.forEach(item => {
                    if (item.quantity <= item.minLevel) {
                        const reorderQty = Math.ceil((item.minLevel * 2) - item.quantity);
                        const orderItem = {
                            category, name: item.name, itemCode: item.itemCode, unit: item.unit, current: item.quantity,
                            reorderQty, cost: item.cost, total: reorderQty * item.cost,
                            status: item.quantity <= item.minLevel / 2 ? 'CRITICAL' : 'LOW',
                            supplier: item.supplier || 'Harvest'
                        };

                        if (orderItem.supplier === 'Kroger') {
                            krogerItems.push(orderItem);
                        } else {
                            harvestItems.push(orderItem);
                        }
                    }
                });
            }

            if (krogerItems.length === 0 && harvestItems.length === 0) {
                content.innerHTML = '<div class="alert-box alert-success">All items fully stocked!</div>';
                return;
            }

            let html = '';

            // Thursday Count Status Header
            const lastThursdayCount = countHistory.filter(c => c.countType === 'Thursday').sort((a, b) => b.timestamp - a.timestamp)[0];
            if (thursdayCountDone && lastThursdayCount) {
                const thursdayDate = new Date(lastThursdayCount.timestamp).toLocaleDateString();
                html += `<div class="alert-box" style="background: #d4edda; border-color: #c3e6cb; color: #155724; margin-bottom: 20px;">
                    <strong>‚úÖ Order Based on Thursday Night Count</strong><br>
                    <span style="font-size: 14px;">Count completed: ${thursdayDate} at ${new Date(lastThursdayCount.timestamp).toLocaleTimeString()}</span>
                </div>`;
            } else {
                html += `<div class="alert-box alert-danger" style="margin-bottom: 20px;">
                    <strong>‚ö†Ô∏è Thursday Count Not Found</strong><br>
                    <span style="font-size: 14px;">Order quantities may be inaccurate. Please complete Thursday night count before ordering.</span>
                </div>`;
            }

            // Kroger Order Section
            if (krogerItems.length > 0) {
                const krogerTotal = krogerItems.reduce((sum, item) => sum + item.total, 0);
                html += `<div style="background: #e7f3ff; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #0c5460;">
                    <h3>ü•õ Kroger Order - ${new Date().toLocaleDateString()}</h3>
                    <p><strong>Items:</strong> ${krogerItems.length} | <strong>Total:</strong> $${krogerTotal.toFixed(2)}</p>
                </div><table><thead><tr><th>Code</th><th>Item</th><th>Current</th><th>Order Qty</th><th>Unit Cost</th><th>Total</th></tr></thead><tbody>`;

                krogerItems.forEach(item => {
                    html += `<tr class="${item.status === 'CRITICAL' ? 'low-stock' : ''}">
                        <td><span class="item-code">${item.itemCode}</span></td>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.current} ${item.unit}</td>
                        <td><strong>${item.reorderQty} ${item.unit}</strong></td>
                        <td>$${item.cost.toFixed(2)}</td>
                        <td><strong>$${item.total.toFixed(2)}</strong></td>
                    </tr>`;
                });

                html += '</tbody></table>';
            }

            // Harvest Roasting Order Section
            if (harvestItems.length > 0) {
                const harvestTotal = harvestItems.reduce((sum, item) => sum + item.total, 0);
                html += `<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3>üì¶ Harvest Roasting Order - ${new Date().toLocaleDateString()}</h3>
                    <p><strong>Items:</strong> ${harvestItems.length} | <strong>Total:</strong> $${harvestTotal.toFixed(2)}</p>
                </div><table><thead><tr><th>Code</th><th>Item</th><th>Current</th><th>Order Qty</th><th>Unit Cost</th><th>Total</th></tr></thead><tbody>`;

                harvestItems.forEach(item => {
                    html += `<tr class="${item.status === 'CRITICAL' ? 'low-stock' : ''}">
                        <td><span class="item-code">${item.itemCode}</span></td>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.current}</td>
                        <td><strong>${item.reorderQty} ${item.unit}</strong></td>
                        <td>$${item.cost.toFixed(2)}</td>
                        <td><strong>$${item.total.toFixed(2)}</strong></td>
                    </tr>`;
                });

                html += '</tbody></table>';
            }

            // Total Summary
            const grandTotal = (krogerItems.reduce((sum, item) => sum + item.total, 0)) +
                             (harvestItems.reduce((sum, item) => sum + item.total, 0));
            html += `<div class="alert-box alert-success">
                <strong>Grand Total (Both Suppliers):</strong> $${grandTotal.toFixed(2)}
            </div>`;

            content.innerHTML = html;
        }

        function emailOrderSheet() {
            const krogerItems = [];
            const harvestItems = [];

            // Check if Thursday count was done
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            yesterday.setHours(0, 0, 0, 0);
            const thursdayCountDone = countHistory.some(c => {
                const countDate = new Date(c.timestamp);
                countDate.setHours(0, 0, 0, 0);
                return countDate.getTime() === yesterday.getTime() && c.countType === 'Thursday';
            });

            for (const [category, items] of Object.entries(inventory)) {
                items.forEach(item => {
                    if (item.quantity <= item.minLevel) {
                        const reorderQty = Math.ceil((item.minLevel * 2) - item.quantity);
                        const orderItem = {
                            category, name: item.name, itemCode: item.itemCode, unit: item.unit, current: item.quantity, reorderQty,
                            cost: item.cost, total: reorderQty * item.cost, supplier: item.supplier || 'Harvest'
                        };

                        if (orderItem.supplier === 'Kroger') {
                            krogerItems.push(orderItem);
                        } else {
                            harvestItems.push(orderItem);
                        }
                    }
                });
            }

            if (krogerItems.length === 0 && harvestItems.length === 0) {
                alert('No items need ordering!');
                return;
            }

            let emailBody = `SCOOTERS COFFEE #2106 - WEEKLY ORDER\nDate: ${new Date().toLocaleDateString()}\nAllen, Texas\n\n`;

            // Thursday Count Status
            const lastThursdayCount = countHistory.filter(c => c.countType === 'Thursday').sort((a, b) => b.timestamp - a.timestamp)[0];
            if (thursdayCountDone && lastThursdayCount) {
                const thursdayDate = new Date(lastThursdayCount.timestamp).toLocaleDateString();
                const thursdayTime = new Date(lastThursdayCount.timestamp).toLocaleTimeString();
                emailBody += `‚úÖ Based on Thursday Night Count\n   Completed: ${thursdayDate} at ${thursdayTime}\n\n`;
            } else {
                emailBody += `‚ö†Ô∏è WARNING: Thursday count not completed!\n   Order quantities may be inaccurate.\n\n`;
            }

            // Kroger Order Section
            if (krogerItems.length > 0) {
                const krogerTotal = krogerItems.reduce((sum, item) => sum + item.total, 0);
                emailBody += `${'='.repeat(70)}\nKROGER ORDER\n${'='.repeat(70)}\n\n`;
                emailBody += `Total Items: ${krogerItems.length}\n`;
                emailBody += `Estimated Cost: $${krogerTotal.toFixed(2)}\n\n`;

                krogerItems.forEach(item => {
                    emailBody += `Code: ${item.itemCode} - ${item.name}\n`;
                    emailBody += `  Current: ${item.current} ${item.unit} | Order: ${item.reorderQty} ${item.unit}\n`;
                    emailBody += `  Cost: $${item.cost.toFixed(2)} each = $${item.total.toFixed(2)} total\n\n`;
                });

                emailBody += `KROGER TOTAL: $${krogerTotal.toFixed(2)}\n\n`;
            }

            // Harvest Roasting Order Section
            if (harvestItems.length > 0) {
                const harvestTotal = harvestItems.reduce((sum, item) => sum + item.total, 0);
                emailBody += `${'='.repeat(70)}\nHARVEST ROASTING ORDER\n${'='.repeat(70)}\n\n`;
                emailBody += `Total Items: ${harvestItems.length}\n`;
                emailBody += `Estimated Cost: $${harvestTotal.toFixed(2)}\n\n`;

                let currentCategory = '';
                harvestItems.forEach(item => {
                    if (item.category !== currentCategory) {
                        currentCategory = item.category;
                        emailBody += `\n${currentCategory.toUpperCase()}\n${'-'.repeat(50)}\n`;
                    }
                    emailBody += `Code: ${item.itemCode} - ${item.name}\n`;
                    emailBody += `  Current: ${item.current} | Order: ${item.reorderQty} ${item.unit}\n`;
                    emailBody += `  Cost: $${item.cost.toFixed(2)} each = $${item.total.toFixed(2)} total\n\n`;
                });

                emailBody += `HARVEST ROASTING TOTAL: $${harvestTotal.toFixed(2)}\n\n`;
            }

            // Grand Total
            const grandTotal = (krogerItems.reduce((sum, item) => sum + item.total, 0)) +
                             (harvestItems.reduce((sum, item) => sum + item.total, 0));
            emailBody += `${'='.repeat(70)}\nGRAND TOTAL (BOTH SUPPLIERS): $${grandTotal.toFixed(2)}\n${'='.repeat(70)}`;

            const recipients = [settings.storeEmail, settings.managerEmails].filter(e => e).join(',');
            const mailtoLink = `mailto:${recipients}?subject=${encodeURIComponent('Weekly Order - ' + new Date().toLocaleDateString())}&body=${encodeURIComponent(emailBody)}`;
            window.location.href = mailtoLink;
        }

        // MILK TRACKING FUNCTIONS
        function addMilkOrder() {
            const date = document.getElementById('milkDate').value;
            const twoPercent = parseFloat(document.getElementById('milk2Percent').value) || 0;
            const skim = parseFloat(document.getElementById('milkSkim').value) || 0;
            const whole = parseFloat(document.getElementById('milkWhole').value) || 0;

            if (!date || (twoPercent === 0 && skim === 0 && whole === 0)) {
                alert('Please enter date and at least one milk type!');
                return;
            }

            const totalGal = twoPercent + skim + whole;
            const cost = totalGal * KROGER_MILK_PRICE;

            milkOrders.push({
                date,
                twoPercent,
                skim,
                whole,
                totalGal,
                cost,
                timestamp: Date.now()
            });

            saveToFirebase('milkOrders', milkOrders);

            // Clear form
            document.getElementById('milkDate').value = '';
            document.getElementById('milk2Percent').value = '';
            document.getElementById('milkSkim').value = '';
            document.getElementById('milkWhole').value = '';

            updateSmartOrderDisplay();
            alert(`Milk order added! ${totalGal} gal @ $${cost.toFixed(2)}`);
        }

        function getWeeklyMilkTotal() {
            const oneWeekAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
            const weekOrders = milkOrders.filter(order => order.timestamp > oneWeekAgo);

            let totalGal = 0;
            let totalCost = 0;
            let twoPercent = 0, skim = 0, whole = 0;

            weekOrders.forEach(order => {
                totalGal += order.totalGal;
                totalCost += order.cost;
                twoPercent += order.twoPercent;
                skim += order.skim;
                whole += order.whole;
            });

            return { totalGal, totalCost, twoPercent, skim, whole, orderCount: weekOrders.length };
        }

        function displayMilkSummary() {
            const weekly = getWeeklyMilkTotal();

            document.getElementById('milkTotalGal').textContent = weekly.totalGal.toFixed(0);
            document.getElementById('milkWeeklyCost').textContent = weekly.totalCost.toFixed(2);

            // Par level status
            let parStatus = '';
            let parColor = '';
            if (weekly.totalGal < milkParLevels.total * 0.8) {
                parStatus = '‚ö†Ô∏è Under';
                parColor = '#856404';
            } else if (weekly.totalGal > milkParLevels.total * 1.2) {
                parStatus = '‚ö†Ô∏è Over';
                parColor = '#721c24';
            } else {
                parStatus = '‚úì On Track';
                parColor = '#155724';
            }
            document.getElementById('milkParStatus').innerHTML = `<span style="color: ${parColor}">${parStatus}</span>`;

            // Cost comparison
            const harvestCost = weekly.totalGal * HARVEST_MILK_PRICE;
            const savings = harvestCost - weekly.totalCost;
            const monthlySavings = savings * 4.33;

            document.getElementById('milkCostComparison').innerHTML = `
                <div style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 8px;">
                    <h4>üí∞ Cost Comparison</h4>
                    <table style="width: 100%; margin-top: 10px; background: white;">
                        <tr>
                            <td><strong>Kroger Price:</strong></td>
                            <td>$${KROGER_MILK_PRICE.toFixed(2)}/gal</td>
                            <td><strong>This Week:</strong> $${weekly.totalCost.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td><strong>Harvest Price:</strong></td>
                            <td>$${HARVEST_MILK_PRICE.toFixed(2)}/gal</td>
                            <td><strong>Would Cost:</strong> $${harvestCost.toFixed(2)}</td>
                        </tr>
                        <tr class="green">
                            <td colspan="2"><strong>Weekly Savings:</strong></td>
                            <td><strong>$${savings.toFixed(2)}</strong></td>
                        </tr>
                        <tr class="green">
                            <td colspan="2"><strong>Monthly Savings:</strong></td>
                            <td><strong>$${monthlySavings.toFixed(2)}</strong></td>
                        </tr>
                    </table>
                </div>
            `;

            // Milk history
            if (milkOrders.length > 0) {
                let historyHtml = '<div style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 8px;"><h4>Recent Orders</h4><table style="width: 100%; margin-top: 10px; background: white;"><thead><tr><th>Date</th><th>2%</th><th>Skim</th><th>Whole</th><th>Total (gal)</th><th>Cost</th></tr></thead><tbody>';

                milkOrders.slice().reverse().slice(0, 5).forEach(order => {
                    historyHtml += `<tr>
                        <td>${new Date(order.date).toLocaleDateString()}</td>
                        <td>${order.twoPercent}</td>
                        <td>${order.skim}</td>
                        <td>${order.whole}</td>
                        <td><strong>${order.totalGal}</strong></td>
                        <td>$${order.cost.toFixed(2)}</td>
                    </tr>`;
                });

                historyHtml += '</tbody></table></div>';
                document.getElementById('milkHistory').innerHTML = historyHtml;
            }
        }

        // SMART ORDER BUDGET
        function setWeeklySales() {
            weeklySales = parseFloat(document.getElementById('weekSalesInput').value) || 8750;
            saveToFirebase('weeklySales', weeklySales);
            updateSmartOrderDisplay();
        }

        function updateSmartOrderDisplay() {
            // Calculate totals including milk
            const maxBudget = weeklySales * 0.32;
            const harvestTotal = calculateOrderTotal();
            const milkTotal = getWeeklyMilkTotal().totalCost;
            const orderTotal = harvestTotal + milkTotal;
            const remaining = maxBudget - orderTotal;

            document.getElementById('weeklySales').textContent = weeklySales.toFixed(0);
            document.getElementById('maxBudget').textContent = maxBudget.toFixed(2);
            document.getElementById('orderTotal').textContent = orderTotal.toFixed(2);
            document.getElementById('budgetRemaining').textContent = remaining.toFixed(2);
            document.getElementById('monthlySavings').textContent = monthlySavings.toFixed(2);

            // Budget alert
            const alertDiv = document.getElementById('budgetAlert');
            if (orderTotal === 0) {
                alertDiv.innerHTML = '';
            } else {
                let breakdownHtml = `<div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <strong>Budget Breakdown:</strong><br>
                    Harvest Roasting: $${harvestTotal.toFixed(2)}<br>
                    Kroger Milk: $${milkTotal.toFixed(2)}<br>
                    <strong>Total COGS: $${orderTotal.toFixed(2)}</strong>
                </div>`;

                if (remaining < 0) {
                    alertDiv.innerHTML = `<div class="alert-box alert-danger">
                        <h3>‚ö†Ô∏è OVER BUDGET!</h3>
                        <p style="font-size: 32px; margin: 10px 0;">You are $${Math.abs(remaining).toFixed(2)} OVER your COGS budget!</p>
                        ${breakdownHtml}
                        <p>Reduce your order or increase sales to stay within 32% COGS target.</p>
                    </div>`;
                } else if (remaining < maxBudget * 0.1) {
                    alertDiv.innerHTML = `<div class="alert-box alert-warning">
                        <h3>‚ö†Ô∏è Close to Budget Limit</h3>
                        <p>You have $${remaining.toFixed(2)} remaining (${(remaining / maxBudget * 100).toFixed(1)}% of budget)</p>
                        ${breakdownHtml}
                    </div>`;
                } else {
                    alertDiv.innerHTML = `<div class="alert-box alert-success">
                        <h3>‚úì Within Budget</h3>
                        <p>You have $${remaining.toFixed(2)} remaining (${(remaining / maxBudget * 100).toFixed(1)}% of budget)</p>
                        ${breakdownHtml}
                    </div>`;
                }
            }

            // Display milk summary
            displayMilkSummary();

            // Display par levels
            displayParLevels();
        }

        function calculateOrderTotal() {
            let total = 0;
            for (const [code, data] of Object.entries(currentOrder)) {
                const item = findItemByCode(code);
                if (item && data.quantity > 0) {
                    total += item.cost * data.quantity;
                }
            }
            return total;
        }

        function findItemByCode(code) {
            for (const [category, items] of Object.entries(inventory)) {
                const item = items.find(i => i.itemCode === code);
                if (item) return item;
            }
            return null;
        }

        function loadSuggestedOrder() {
            currentOrder = {};
            let html = '<table><thead><tr><th>Code</th><th>Item</th><th>Par Level</th><th>Order Qty</th><th>Cost</th><th>Total</th><th>Variance</th></tr></thead><tbody>';

            for (const [code, data] of Object.entries(parLevels)) {
                const item = findItemByCode(code);
                if (item) {
                    currentOrder[code] = { quantity: data.parQty };
                    const itemTotal = item.cost * data.parQty;
                    const varianceClass = data.variance === 'High' ? 'red' : data.variance === 'Medium' ? 'yellow' : '';

                    html += `<tr class="${varianceClass}">
                        <td><span class="item-code">${code}</span></td>
                        <td><strong>${data.name}</strong></td>
                        <td>${data.parQty} ${data.unit}</td>
                        <td><input type="number" class="order-input" value="${data.parQty}" onchange="updateOrderQty('${code}', this.value)"></td>
                        <td>$${item.cost.toFixed(2)}</td>
                        <td><strong>$${itemTotal.toFixed(2)}</strong></td>
                        <td><span class="status-badge ${varianceClass ? 'status-critical' : 'status-ok'}">${data.variance}</span></td>
                    </tr>`;
                }
            }

            html += '</tbody></table>';
            document.getElementById('smartOrderTable').innerHTML = html;
            updateSmartOrderDisplay();
            checkOverOrder();
        }

        function updateOrderQty(code, value) {
            const qty = parseFloat(value) || 0;
            currentOrder[code] = { quantity: qty };
            updateSmartOrderDisplay();
            checkOverOrder();
        }

        function checkOverOrder() {
            if (orderHistory.length === 0) return;

            const lastOrder = orderHistory[orderHistory.length - 1];
            const overOrders = [];

            for (const [code, data] of Object.entries(currentOrder)) {
                const lastQty = lastOrder.items[code] || 0;
                if (data.quantity > lastQty) {
                    const item = findItemByCode(code);
                    overOrders.push({
                        name: parLevels[code]?.name || item.name,
                        lastQty,
                        newQty: data.quantity,
                        increase: data.quantity - lastQty,
                        wasteValue: (data.quantity - lastQty) * item.cost
                    });
                }
            }

            const alertDiv = document.getElementById('overOrderAlert');
            if (overOrders.length > 0) {
                let html = `<div class="alert-box alert-warning" style="margin-top: 20px;">
                    <h3>‚ö†Ô∏è Over-Order Alert</h3>
                    <p>You are ordering MORE of these items than last week:</p>
                    <table style="margin-top: 10px; background: white;"><thead><tr><th>Item</th><th>Last Week</th><th>This Week</th><th>Increase</th><th>Potential Waste</th></tr></thead><tbody>`;

                overOrders.forEach(item => {
                    html += `<tr class="over-order">
                        <td><strong>${item.name}</strong></td>
                        <td>${item.lastQty}</td>
                        <td>${item.newQty}</td>
                        <td>+${item.increase}</td>
                        <td><strong>$${item.wasteValue.toFixed(2)}</strong></td>
                    </tr>`;
                });

                const totalWaste = overOrders.reduce((sum, item) => sum + item.wasteValue, 0);
                html += `</tbody></table><p style="margin-top: 10px; font-size: 18px;"><strong>Total Potential Waste: $${totalWaste.toFixed(2)}</strong></p></div>`;
                alertDiv.innerHTML = html;
            } else {
                alertDiv.innerHTML = '<div class="alert-box alert-success">‚úì No over-ordering detected!</div>';
            }
        }

        function displayParLevels() {
            let html = '<table><thead><tr><th>Item</th><th>Par Level</th><th>Last 3 Orders</th><th>Variance</th></tr></thead><tbody>';

            for (const [code, data] of Object.entries(parLevels)) {
                const varianceClass = data.variance === 'High' ? 'status-critical' : data.variance === 'Medium' ? 'status-low' : 'status-ok';
                html += `<tr>
                    <td><strong>${data.name}</strong> <span class="item-code">${code}</span></td>
                    <td><strong>${data.parQty} ${data.unit}</strong></td>
                    <td>${data.history.join(', ')}</td>
                    <td><span class="status-badge ${varianceClass}">${data.variance}</span></td>
                </tr>`;
            }

            html += '</tbody></table>';
            html += '<p style="margin-top: 10px; font-size: 13px; color: #666;"><strong>High variance items</strong> need attention - inconsistent ordering may indicate waste or stock issues.</p>';
            document.getElementById('parLevelsDisplay').innerHTML = html;
        }

        function saveCurrentOrder() {
            if (Object.keys(currentOrder).length === 0) {
                alert('No order to save!');
                return;
            }

            const orderTotal = calculateOrderTotal();
            const maxBudget = weeklySales * 0.32;

            // Calculate savings vs average
            const avgSpend = 2661;
            const savings = avgSpend - orderTotal;
            if (savings > 0) {
                monthlySavings += savings;
                saveToFirebase('monthlySavings', monthlySavings);
            }

            orderHistory.push({
                date: new Date().toISOString(),
                items: {...currentOrder},
                total: orderTotal,
                budget: maxBudget,
                savings: savings
            });

            saveToFirebase('orderHistory', orderHistory);
            updateSmartOrderDisplay();
            alert(`Order saved! Total: $${orderTotal.toFixed(2)}${savings > 0 ? `\nSavings: $${savings.toFixed(2)}` : ''}`);
        }

        function emailSmartOrder() {
            if (Object.keys(currentOrder).length === 0) {
                alert('Load suggested order first!');
                return;
            }

            const harvestTotal = calculateOrderTotal();
            const milkTotal = getWeeklyMilkTotal().totalCost;
            const orderTotal = harvestTotal + milkTotal;
            const maxBudget = weeklySales * 0.32;
            const remaining = maxBudget - orderTotal;

            let emailBody = `SCOOTERS COFFEE #2106 - SMART ORDER\nDate: ${new Date().toLocaleDateString()}\nAllen, Texas\n\n`;
            emailBody += `BUDGET SUMMARY:\n${'='.repeat(70)}\n`;
            emailBody += `Weekly Sales: $${weeklySales.toFixed(2)}\n`;
            emailBody += `Max COGS Budget (32%): $${maxBudget.toFixed(2)}\n`;
            emailBody += `Harvest Roasting Order: $${harvestTotal.toFixed(2)}\n`;
            emailBody += `Kroger Milk (this week): $${milkTotal.toFixed(2)}\n`;
            emailBody += `Total COGS: $${orderTotal.toFixed(2)}\n`;
            emailBody += `Remaining Budget: $${remaining.toFixed(2)}\n`;
            emailBody += `Status: ${remaining >= 0 ? '‚úì WITHIN BUDGET' : '‚ö†Ô∏è OVER BUDGET'}\n\n`;

            emailBody += `HARVEST ROASTING ORDER:\n${'='.repeat(70)}\n\n`;

            for (const [code, data] of Object.entries(currentOrder)) {
                if (data.quantity > 0) {
                    const item = findItemByCode(code);
                    const parData = parLevels[code];
                    if (item && parData) {
                        emailBody += `Code: ${code} - ${parData.name}\n`;
                        emailBody += `  Quantity: ${data.quantity} ${parData.unit}\n`;
                        emailBody += `  Cost: $${item.cost.toFixed(2)} each = $${(item.cost * data.quantity).toFixed(2)} total\n`;
                        emailBody += `  Par Level: ${parData.parQty} (Variance: ${parData.variance})\n\n`;
                    }
                }
            }

            emailBody += `\n${'='.repeat(70)}\n`;
            emailBody += `HARVEST ROASTING TOTAL: $${harvestTotal.toFixed(2)}\n`;
            emailBody += `\nGenerated by Smart Order Budget - https://newgardcg.github.io/scooters-inventory/`;

            const recipients = [settings.storeEmail, settings.managerEmails].filter(e => e).join(',');
            const mailtoLink = `mailto:${recipients}?subject=${encodeURIComponent('Smart Order - ' + new Date().toLocaleDateString())}&body=${encodeURIComponent(emailBody)}`;
            window.location.href = mailtoLink;
        }

        // COGS Gap Tracker
        function addCOGSEntry() {
            const weekDate = document.getElementById('weekDate').value;
            const netSales = parseFloat(document.getElementById('netSales').value);
            const theoreticalCOGS = parseFloat(document.getElementById('theoreticalCOGS').value);
            const actualCOGS = parseFloat(document.getElementById('actualCOGS').value);
            const categoryIssue = document.getElementById('categoryIssue').value;

            if (!weekDate || !netSales || !theoreticalCOGS || !actualCOGS) {
                alert('Please fill in all fields!');
                return;
            }

            const theoreticalDollar = (theoreticalCOGS / 100) * netSales;
            const actualDollar = (actualCOGS / 100) * netSales;
            const gap = actualDollar - theoreticalDollar;

            cogsData.push({
                weekDate, netSales, theoreticalCOGS, actualCOGS, theoreticalDollar, actualDollar, gap, categoryIssue, timestamp: Date.now()
            });

            saveToFirebase('cogsData', cogsData);
            updateCOGSDisplay();

            // Clear form
            document.getElementById('weekDate').value = '';
            document.getElementById('netSales').value = '';
            document.getElementById('theoreticalCOGS').value = '';
            document.getElementById('actualCOGS').value = '';
            document.getElementById('categoryIssue').value = '';

            alert('COGS data added successfully!');
        }

        function updateCOGSDisplay() {
            // Update summary cards
            if (cogsData.length > 0) {
                const latest = cogsData[cogsData.length - 1];
                document.getElementById('currentGap').textContent = Math.abs(latest.gap).toFixed(2);
                document.getElementById('currentActual').textContent = latest.actualCOGS.toFixed(2);

                // Calculate month total
                const monthGap = cogsData.reduce((sum, entry) => sum + entry.gap, 0);
                document.getElementById('monthGap').textContent = Math.abs(monthGap).toFixed(2);
            }

            // Display COGS history
            const historyDiv = document.getElementById('cogsHistory');
            if (cogsData.length === 0) {
                historyDiv.innerHTML = '<div class="alert-box alert-warning">No COGS data yet. Add your first entry above!</div>';
                return;
            }

            let html = '<h3 style="margin: 30px 0 15px;">COGS History</h3><table><thead><tr><th>Week Ending</th><th>Net Sales</th><th>Theoretical %</th><th>Actual %</th><th>Gap ($)</th><th>Problem Area</th><th>Trend</th></tr></thead><tbody>';

            cogsData.slice().reverse().forEach((entry, index) => {
                const prevIndex = cogsData.length - index - 2;
                let trend = '‚Äî';
                if (prevIndex >= 0) {
                    const prevGap = cogsData[prevIndex].gap;
                    if (entry.gap < prevGap) trend = '‚úì Improving';
                    else if (entry.gap > prevGap) trend = '‚ö† Worsening';
                    else trend = '‚Äî Same';
                }

                const rowClass = entry.gap > 1000 ? 'red' : entry.gap > 500 ? 'yellow' : 'green';
                html += `<tr class="${rowClass}">
                    <td>${new Date(entry.weekDate).toLocaleDateString()}</td>
                    <td>$${entry.netSales.toFixed(2)}</td>
                    <td>${entry.theoreticalCOGS.toFixed(2)}%</td>
                    <td><strong>${entry.actualCOGS.toFixed(2)}%</strong></td>
                    <td><strong>$${Math.abs(entry.gap).toFixed(2)}</strong></td>
                    <td>${entry.categoryIssue || 'N/A'}</td>
                    <td>${trend}</td>
                </tr>`;
            });

            html += '</tbody></table>';
            historyDiv.innerHTML = html;
        }

        function emailCOGSSummary() {
            if (cogsData.length === 0) {
                alert('No COGS data to email!');
                return;
            }

            const latest = cogsData[cogsData.length - 1];
            const monthGap = cogsData.reduce((sum, entry) => sum + entry.gap, 0);

            let emailBody = `SCOOTERS COFFEE #2106 - WEEKLY COGS SUMMARY\nDate: ${new Date().toLocaleDateString()}\nAllen, Texas\n\n`;
            emailBody += `THIS WEEK'S PERFORMANCE:\n${'='.repeat(50)}\n`;
            emailBody += `Week Ending: ${new Date(latest.weekDate).toLocaleDateString()}\n`;
            emailBody += `Net Sales: $${latest.netSales.toFixed(2)}\n`;
            emailBody += `Theoretical COGS: ${latest.theoreticalCOGS.toFixed(2)}% ($${latest.theoreticalDollar.toFixed(2)})\n`;
            emailBody += `Actual COGS: ${latest.actualCOGS.toFixed(2)}% ($${latest.actualDollar.toFixed(2)})\n`;
            emailBody += `GAP: $${Math.abs(latest.gap).toFixed(2)} ${latest.gap > 0 ? 'OVER' : 'UNDER'} theoretical\n`;
            emailBody += `Problem Category: ${latest.categoryIssue || 'N/A'}\n\n`;

            emailBody += `MONTH-TO-DATE:\n${'='.repeat(50)}\n`;
            emailBody += `Total COGS Gap: $${Math.abs(monthGap).toFixed(2)}\n`;
            emailBody += `Weeks Tracked: ${cogsData.length}\n`;
            emailBody += `Average Gap per Week: $${Math.abs(monthGap / cogsData.length).toFixed(2)}\n\n`;

            // Check if improving
            if (cogsData.length > 1) {
                const prev = cogsData[cogsData.length - 2];
                const trend = latest.gap < prev.gap ? 'IMPROVING ‚úì' : 'NEEDS ATTENTION ‚ö†';
                emailBody += `Trend: ${trend}\n`;
                emailBody += `Change from last week: $${Math.abs(latest.gap - prev.gap).toFixed(2)}\n\n`;
            }

            emailBody += `ACTION ITEMS:\n${'='.repeat(50)}\n`;
            emailBody += `‚òê All employee drinks rung in?\n`;
            emailBody += `‚òê Food waste minimized?\n`;
            emailBody += `‚òê Waste log accurate?\n`;
            emailBody += `‚òê Compare Power BI theoretical vs actual\n`;
            emailBody += `‚òê Review ${latest.categoryIssue || 'problem categories'}\n\n`;

            emailBody += `TARGET: 32% COGS | CURRENT: ${latest.actualCOGS.toFixed(2)}%`;

            const recipients = [settings.storeEmail, settings.managerEmails].filter(e => e).join(',');
            const mailtoLink = `mailto:${recipients}?subject=${encodeURIComponent('COGS Gap Summary - Week Ending ' + new Date(latest.weekDate).toLocaleDateString())}&body=${encodeURIComponent(emailBody)}`;
            window.location.href = mailtoLink;
        }

        // Menu Profitability Tracker
        function updateMenuDisplay() {
            const greenItems = menuItems.filter(item => item.cogs < 30);
            const yellowItems = menuItems.filter(item => item.cogs >= 30 && item.cogs <= 45);
            const redItems = menuItems.filter(item => item.cogs > 45);

            const avgCOGS = menuItems.reduce((sum, item) => sum + item.cogs, 0) / menuItems.length;
            document.getElementById('avgCOGS').textContent = avgCOGS.toFixed(2);

            const sortedByCOGS = [...menuItems].sort((a, b) => a.cogs - b.cogs);
            const best = sortedByCOGS[0];
            const worst = sortedByCOGS[sortedByCOGS.length - 1];

            document.getElementById('bestItem').innerHTML = `<strong>${best.name}</strong><br>${best.cogs.toFixed(2)}% COGS | $${best.sales} sales`;
            document.getElementById('worstItem').innerHTML = `<strong>${worst.name}</strong><br>${worst.cogs.toFixed(2)}% COGS | $${worst.sales} sales`;

            const topMargin = sortedByCOGS.slice(0, 3);
            let pushHTML = '<div style="font-size: 18px; font-weight: 600; margin-bottom: 15px;">Push These High-Margin Items Today:</div>';
            topMargin.forEach((item, index) => {
                const profit = item.price - (item.price * item.cogs / 100);
                pushHTML += `<div style="padding: 10px; background: rgba(255,255,255,0.2); border-radius: 4px; margin: 8px 0;">
                    ${index + 1}. <strong>${item.name}</strong> - ${item.cogs.toFixed(1)}% COGS
                    <br><span style="font-size: 14px;">Profit per item: $${profit.toFixed(2)}</span>
                </div>`;
            });
            document.getElementById('pushRecommendation').innerHTML = pushHTML;

            const latte = menuItems.find(item => item.name.includes('MED Flavored Latte'));
            const eggBite = menuItems.find(item => item.name.includes('Egg Bites'));
            const latteProfit = latte.price - (latte.price * latte.cogs / 100);
            const eggBiteProfit = eggBite.price - (eggBite.price * eggBite.cogs / 100);
            const savings = latteProfit - eggBiteProfit;
            document.getElementById('weeklyTip').textContent = `Every latte upsold instead of egg bites saves you $${savings.toFixed(2)} in profit!`;

            const displayDiv = document.getElementById('menuItemsDisplay');
            let html = '';

            if (greenItems.length > 0) {
                html += '<div class="profit-item profit-green"><h3>‚úì HIGH MARGIN ITEMS (Under 30% COGS)</h3>';
                greenItems.sort((a, b) => a.cogs - b.cogs).forEach(item => {
                    const profit = item.price - (item.price * item.cogs / 100);
                    html += `<div style="padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.5); border-radius: 4px;">
                        <strong>${item.name}</strong> - ${item.cogs.toFixed(2)}% COGS | $${item.sales} sales
                        <br><span style="font-size: 12px; color: #155724;">Profit per item: $${profit.toFixed(2)} | Price: $${item.price}</span>
                    </div>`;
                });
                html += '</div>';
            }

            if (yellowItems.length > 0) {
                html += '<div class="profit-item profit-yellow"><h3>‚ö† MEDIUM MARGIN ITEMS (30-45% COGS)</h3>';
                yellowItems.sort((a, b) => a.cogs - b.cogs).forEach(item => {
                    const profit = item.price - (item.price * item.cogs / 100);
                    html += `<div style="padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.5); border-radius: 4px;">
                        <strong>${item.name}</strong> - ${item.cogs.toFixed(2)}% COGS | $${item.sales} sales
                        <br><span style="font-size: 12px; color: #856404;">Profit per item: $${profit.toFixed(2)} | Price: $${item.price}</span>
                    </div>`;
                });
                html += '</div>';
            }

            if (redItems.length > 0) {
                html += '<div class="profit-item profit-red"><h3>‚õî LOW MARGIN ITEMS (Over 45% COGS)</h3>';
                redItems.sort((a, b) => b.cogs - a.cogs).forEach(item => {
                    const profit = item.price - (item.price * item.cogs / 100);
                    html += `<div style="padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.5); border-radius: 4px;">
                        <strong>${item.name}</strong> - ${item.cogs.toFixed(2)}% COGS | $${item.sales} sales
                        <br><span style="font-size: 12px; color: #721c24;">Profit per item: $${profit.toFixed(2)} | Price: $${item.price} | Consider price increase or portion control</span>
                    </div>`;
                });
                html += '</div>';
            }

            displayDiv.innerHTML = html;
        }

        function checkFriday() {
            if (new Date().getDay() === 5) {
                document.getElementById('fridayAlert').innerHTML = `
                    <div class="alert-box alert-success">
                        <h3>üéØ It's Friday! Time to Order</h3>
                        <button onclick="switchView('smartOrder')" style="margin-top: 10px;">Go to Smart Order Budget ‚Üí</button>
                    </div>
                `;
            }
        }

        window.onload = function() {
            loadData();
        };
    </script>
</body>
</html>
